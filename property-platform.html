<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HomeClear - Your Property Journey, Simplified</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#8b5cf6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="HomeClear">
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180x180.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica', Arial, sans-serif;
            background: #fafafa;
            color: #000000;
            line-height: 1.6;
        }
        
        /* Header */
        .header {
            border-bottom: 1px solid #e5e5e5;
            padding: 24px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: #fff;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .logo {
            font-size: 22px;
            font-weight: 500;
            letter-spacing: -0.5px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .notification-badge {
            position: relative;
            cursor: pointer;
            font-size: 20px;
        }
        
        .badge-dot {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 8px;
            height: 8px;
            background: #8b5cf6;
            border-radius: 50%;
        }
        
        .user-name {
            font-size: 14px;
            font-weight: 300;
        }
        
        /* Layout */
        .layout {
            display: flex;
            min-height: calc(100vh - 61px);
        }
        
        /* Sidebar */
        .sidebar {
            width: 260px;
            border-right: 1px solid #e5e5e5;
            padding: 32px 0;
            background: #fff;
            box-shadow: 2px 0 8px rgba(0,0,0,0.04);
        }
        
        .nav-item {
            padding: 14px 32px;
            font-size: 15px;
            font-weight: 400;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
            margin: 2px 0;
        }
        
        .nav-item:hover {
            background: #f8f9fa;
            border-left-color: #8b5cf6;
        }
        
        .nav-item.active {
            border-left-color: #8b5cf6;
            background: #f8f9fa;
            font-weight: 500;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 48px 40px;
            max-width: 1200px;
            background: #fafafa;
        }
        
        .view {
            display: none;
        }
        
        .view.active {
            display: block;
        }
        
        /* Page Header */
        .page-header {
            margin-bottom: 40px;
        }
        
        .page-title {
            font-size: 32px;
            font-weight: 400;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }
        
        .page-subtitle {
            font-size: 15px;
            font-weight: 400;
            color: #666;
            line-height: 1.5;
        }
        
        /* Progress Bar */
        .progress-section {
            margin-bottom: 40px;
            padding: 32px;
            border: 1px solid #e5e5e5;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .progress-title {
            font-size: 16px;
            font-weight: 400;
        }
        
        .progress-percentage {
            font-size: 24px;
            font-weight: 300;
            color: #8b5cf6;
        }
        
        .progress-bar {
            height: 10px;
            background: #f0f0f0;
            margin-bottom: 28px;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #8b5cf6, #a855f7);
            width: 65%;
            transition: width 0.6s ease;
            border-radius: 6px;
        }
        
        .progress-stages {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .stage-item {
            text-align: center;
            padding: 20px 16px;
            border: 1px solid #e5e5e5;
            position: relative;
            background: #fff;
            border-radius: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .stage-item.completed {
            border-color: #22c55e;
            background: #f0fdf4;
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.15);
        }
        
        .stage-item.active {
            border-color: #8b5cf6;
            background: #faf5ff;
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.15);
        }
        
        .stage-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .stage-icon {
            font-size: 20px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #f0f0f0;
            color: #666;
        }
        
        .stage-item.completed .stage-icon {
            background: #22c55e;
            color: #fff;
        }
        
        .stage-item.active .stage-icon {
            background: #8b5cf6;
            color: #fff;
        }
        
        .stage-name {
            font-size: 12px;
            font-weight: 300;
            color: #666;
        }
        
        .stage-item.completed .stage-name,
        .stage-item.active .stage-name {
            color: #000;
            font-weight: 400;
        }
        
        /* Cards */
        .card {
            border: 1px solid #e5e5e5;
            padding: 28px;
            margin-bottom: 24px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            transform: translateY(-1px);
        }
        
        .card-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 20px;
            color: #1a1a1a;
        }
        
        .card-section {
            margin-bottom: 25px;
        }
        
        .card-section:last-child {
            margin-bottom: 0;
        }
        
        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 40px;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 16px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e5e5e5;
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 28px;
            padding-left: 24px;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -32px;
            top: 8px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #fff;
            border: 3px solid #e5e5e5;
            z-index: 2;
        }
        
        .timeline-item.new::before {
            background: #8b5cf6;
            border-color: #8b5cf6;
        }
        
        .timeline-date {
            font-size: 12px;
            color: #999;
            margin-bottom: 5px;
        }
        
        .timeline-title {
            font-size: 15px;
            font-weight: 400;
            margin-bottom: 5px;
        }
        
        .timeline-content {
            font-size: 14px;
            font-weight: 300;
            color: #666;
        }
        
        /* People Cards */
        .people-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .person-card {
            border: 1px solid #e5e5e5;
            padding: 24px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            transition: all 0.3s ease;
        }
        
        .person-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            transform: translateY(-2px);
        }
        
        .person-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .person-role {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #8b5cf6;
            margin-bottom: 5px;
        }
        
        .person-name {
            font-size: 16px;
            font-weight: 400;
            margin-bottom: 5px;
        }
        
        .person-company {
            font-size: 13px;
            font-weight: 300;
            color: #666;
        }
        
        .person-status {
            font-size: 11px;
            padding: 4px 8px;
            background: #22c55e;
            color: #fff;
        }
        
        .person-actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }
        
        .btn-small {
            padding: 10px 16px;
            font-size: 13px;
            border: 1px solid #e5e5e5;
            background: #fff;
            cursor: pointer;
            font-family: inherit;
            font-weight: 400;
            flex: 1;
            border-radius: 6px;
            transition: all 0.2s ease;
        }
        
        .btn-small:hover {
            border-color: #8b5cf6;
            color: #8b5cf6;
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(139, 92, 246, 0.15);
        }
        
        /* Fee Breakdown */
        .fee-summary {
            background: #fafafa;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .fee-total {
            display: flex;
            justify-content: space-between;
            font-size: 20px;
            font-weight: 400;
            margin-bottom: 5px;
        }
        
        .fee-subtitle {
            font-size: 13px;
            color: #666;
            font-weight: 300;
        }
        
        .fee-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .fee-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid #e5e5e5;
            background: #fff;
        }
        
        .fee-info {
            flex: 1;
        }
        
        .fee-name {
            font-size: 15px;
            font-weight: 400;
            margin-bottom: 3px;
        }
        
        .fee-description {
            font-size: 12px;
            color: #666;
            font-weight: 300;
        }
        
        .fee-amount {
            font-size: 16px;
            font-weight: 400;
        }
        
        .fee-paid {
            font-size: 11px;
            color: #22c55e;
            margin-top: 3px;
        }
        
        /* Tradespeople */
        .trade-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 12px 20px;
            border: 1px solid #e5e5e5;
            background: #fff;
            font-family: inherit;
            font-size: 13px;
            font-weight: 400;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .filter-btn.active {
            background: #8b5cf6;
            color: #fff;
            border-color: #8b5cf6;
            box-shadow: 0 2px 6px rgba(139, 92, 246, 0.2);
        }
        
        .filter-btn:hover:not(.active) {
            border-color: #8b5cf6;
            color: #8b5cf6;
            transform: translateY(-1px);
        }
        
        .trade-card {
            border: 1px solid #e5e5e5;
            padding: 28px;
            margin-bottom: 20px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            transition: all 0.3s ease;
        }
        
        .trade-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            transform: translateY(-2px);
        }
        
        .trade-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .trade-info {
            flex: 1;
        }
        
        .trade-name {
            font-size: 18px;
            font-weight: 400;
            margin-bottom: 5px;
        }
        
        .trade-specialty {
            font-size: 13px;
            color: #666;
            font-weight: 300;
            margin-bottom: 8px;
        }
        
        .trade-rating {
            font-size: 14px;
            color: #000;
        }
        
        .verified-badge {
            padding: 5px 10px;
            background: #22c55e;
            color: #fff;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .trade-details {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            font-size: 13px;
            font-weight: 300;
            color: #666;
        }
        
        .trade-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 14px 28px;
            font-size: 14px;
            font-family: inherit;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            border-radius: 8px;
            letter-spacing: 0.3px;
        }
        
        .btn-primary {
            background: #000;
            color: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        
        .btn-primary:hover {
            background: #8b5cf6;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }
        
        .btn-secondary {
            background: #fff;
            color: #000;
            border: 1px solid #e5e5e5;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .btn-secondary:hover {
            border-color: #8b5cf6;
            color: #8b5cf6;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.15);
        }
        
        /* Messages */
        .messages-container {
            display: flex;
            gap: 0;
            height: 600px;
            border: 1px solid #e5e5e5;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        
        .messages-list {
            width: 300px;
            border-right: 1px solid #e5e5e5;
            overflow-y: auto;
        }
        
        .message-preview {
            padding: 20px;
            border-bottom: 1px solid #e5e5e5;
            cursor: pointer;
        }
        
        .message-preview:hover {
            background: #fafafa;
        }
        
        .message-preview.active {
            background: #fafafa;
        }
        
        .message-preview.unread {
            background: #faf5ff;
        }
        
        .message-sender {
            font-size: 15px;
            font-weight: 400;
            margin-bottom: 5px;
        }
        
        .message-excerpt {
            font-size: 13px;
            font-weight: 300;
            color: #666;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .message-time {
            font-size: 11px;
            color: #999;
        }
        
        .message-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .message-header {
            padding: 20px;
            border-bottom: 1px solid #e5e5e5;
        }
        
        .message-thread {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .message-bubble {
            max-width: 70%;
            padding: 15px;
            margin-bottom: 15px;
            background: #fafafa;
            border-radius: 2px;
        }
        
        .message-bubble.sent {
            margin-left: auto;
            background: #8b5cf6;
            color: #fff;
        }
        
        .message-input-area {
            padding: 20px;
            border-top: 1px solid #e5e5e5;
        }
        
        .message-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #e5e5e5;
            font-family: inherit;
            font-size: 14px;
            font-weight: 300;
            outline: none;
        }
        
        /* Checklist */
        .checklist {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            padding: 18px 20px;
            border: 1px solid #e5e5e5;
            cursor: pointer;
            background: #fff;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }
        
        .checklist-item:hover {
            border-color: #8b5cf6;
            transform: translateX(4px);
        }
        
        .checklist-item.completed {
            background: #f0fdf4;
            border-color: #22c55e;
            box-shadow: 0 2px 6px rgba(34, 197, 94, 0.1);
        }
        
        .checklist-checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid #e5e5e5;
            margin-right: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s ease;
        }
        
        .checklist-item.completed .checklist-checkbox {
            background: #22c55e;
            border-color: #22c55e;
            color: #fff;
        }
        
        .checklist-text {
            flex: 1;
            font-size: 15px;
            font-weight: 300;
        }
        
        .checklist-item.completed .checklist-text {
            text-decoration: line-through;
            color: #999;
        }
        
        /* Alert Banner */
        .alert {
            padding: 15px 20px;
            margin-bottom: 20px;
            border-left: 3px solid #8b5cf6;
            background: #faf5ff;
            font-size: 14px;
            font-weight: 300;
        }
        
        .alert-info {
            border-left-color: #3b82f6;
            background: #eff6ff;
        }
        
        .alert-success {
            border-left-color: #22c55e;
            background: #f0fdf4;
        }
        
        /* ENHANCEMENT: Modal styles for communication layer */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 32px;
            border: 1px solid #e5e5e5;
            width: 90%;
            max-width: 520px;
            position: relative;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 400;
        }
        
        .close {
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        
        .close:hover {
            color: #000;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 400;
            margin-bottom: 8px;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #e5e5e5;
            font-family: inherit;
            font-size: 14px;
            font-weight: 400;
            outline: none;
            border-radius: 8px;
            transition: all 0.2s ease;
            background: #fff;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
        }
        
        .form-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }
        
        /* ENHANCEMENT: Template buttons */
        .template-btn {
            padding: 6px 12px;
            font-size: 12px;
            border: 1px solid #e5e5e5;
            background: #f8f9fa;
            color: #666;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }
        
        .template-btn:hover {
            background: #8b5cf6;
            color: #fff;
            border-color: #8b5cf6;
        }
        
        .form-textarea {
            height: 80px;
            resize: vertical;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        /* ENHANCEMENT: Status badges for timeline items */
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-radius: 2px;
            margin-left: 8px;
        }
        
        .status-pending {
            background: #faf5ff;
            color: #8b5cf6;
            border: 1px solid #8b5cf6;
        }
        
        .status-sent {
            background: #eff6ff;
            color: #3b82f6;
            border: 1px solid #3b82f6;
        }
        
        .status-received {
            background: #fef3c7;
            color: #f59e0b;
            border: 1px solid #f59e0b;
        }
        
        .status-done {
            background: #f0fdf4;
            color: #22c55e;
            border: 1px solid #22c55e;
        }
        
        /* ENHANCEMENT: Timeline item actions */
        .timeline-actions {
            display: none;
            gap: 8px;
            margin-top: 10px;
        }
        
        .timeline-item:hover .timeline-actions {
            display: flex;
        }
        
        .timeline-action {
            padding: 4px 8px;
            font-size: 11px;
            border: 1px solid #e5e5e5;
            background: #fff;
            cursor: pointer;
            font-family: inherit;
        }
        
        .timeline-action:hover {
            border-color: #8b5cf6;
            color: #8b5cf6;
        }
        
        /* ENHANCEMENT: Saved indicator */
        .saved-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #22c55e;
            color: #fff;
            padding: 8px 16px;
            font-size: 12px;
            border-radius: 2px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .saved-indicator.show {
            opacity: 1;
        }
        
        /* ENHANCEMENT: Notification panel */
        .notification-panel {
            position: fixed;
            top: 80px;
            right: 24px;
            width: 320px;
            background: #fff;
            border: 1px solid #e5e5e5;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            z-index: 1000;
            display: none;
            max-height: 420px;
            overflow-y: auto;
            border-radius: 12px;
        }
        
        .notification-panel.show {
            display: block;
        }
        
        .notification-header {
            padding: 15px 20px;
            border-bottom: 1px solid #e5e5e5;
            font-size: 14px;
            font-weight: 400;
        }
        
        .notification-item {
            padding: 18px 24px;
            border-bottom: 1px solid #f5f5f5;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .notification-item:hover {
            background: #f8f9fa;
            transform: translateX(2px);
        }
        
        .notification-item.unread {
            background: #faf5ff;
        }
        
        .notification-title {
            font-size: 14px;
            font-weight: 400;
            margin-bottom: 5px;
        }
        
        .notification-time {
            font-size: 12px;
            color: #666;
        }
        
        .notification-content {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">HomeClear</div>
        <div class="user-info">
            <!-- ENHANCEMENT: Export/Import menu -->
            <div style="position: relative; margin-right: 15px;">
                <button onclick="toggleDataMenu()" style="background: none; border: none; cursor: pointer; padding: 8px; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='#f5f5f5'" onmouseout="this.style.background='none'">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="color: #666;">
                        <path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"/>
                    </svg>
                </button>
                <div id="dataMenu" style="display: none; position: absolute; top: 100%; right: 0; background: #fff; border: 1px solid #e5e5e5; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); z-index: 1000; min-width: 150px;">
                    <button onclick="exportData()" style="width: 100%; padding: 12px 16px; border: none; background: none; text-align: left; cursor: pointer; border-bottom: 1px solid #f5f5f5; font-size: 14px;">📤 Export Data</button>
                    <button onclick="importData()" style="width: 100%; padding: 12px 16px; border: none; background: none; text-align: left; cursor: pointer; font-size: 14px;">📥 Import Data</button>
                </div>
            </div>
            <div class="notification-badge" onclick="toggleNotifications()" style="cursor: pointer;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="color: #666;">
                    <path d="M12,22A2,2 0 0,0 14,20H10A2,2 0 0,0 12,22M18,16V11L15.5,6.5C15.1,5.8 14.4,5.3 13.6,5.3H10.4C9.6,5.3 8.9,5.8 8.5,6.5L6,11V16H18M8,17H16V19H8V17Z"/>
                </svg>
                <span class="badge-dot" id="notification-dot"></span>
            </div>
            <!-- ENHANCEMENT: Role switcher for different perspectives -->
            <select id="roleSwitcher" onchange="switchRole(this.value)" style="margin-right: 15px; padding: 8px 12px; border: 1px solid #e5e5e5; font-size: 13px; background: #fff; border-radius: 6px; font-weight: 400;">
                <option value="buyer">Buyer View</option>
                <option value="solicitor">Solicitor View</option>
                <option value="agent">Agent View</option>
            </select>
            <div class="user-name" id="userName">Sarah Thompson</div>
        </div>
    </div>
    
    <div class="layout">
        <nav class="sidebar">
            <div class="nav-item active" onclick="showView('dashboard')">Dashboard</div>
            <div class="nav-item" onclick="showView('timeline')">Live Timeline</div>
            <div class="nav-item" onclick="showView('team')">Your Team</div>
            <div class="nav-item" onclick="showView('fees')">Fees & Costs</div>
            <div class="nav-item" onclick="showView('messages')">Messages</div>
            <div class="nav-item" onclick="showView('documents')">Documents</div>
            <div class="nav-item" onclick="showView('tradespeople')">Find Tradespeople</div>
            <div class="nav-item" onclick="showView('checklist')">Move-In Checklist</div>
            <div style="border-top: 1px solid #e5e5e5; margin: 20px 0; padding-top: 20px;">
                <div style="font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: #8b5cf6; padding: 0 30px; margin-bottom: 15px;">Property Search</div>
                <div class="nav-item" onclick="showView('property-search')">🔍 Property Search</div>
            </div>
            <div style="border-top: 1px solid #e5e5e5; margin: 20px 0; padding-top: 20px;">
                <div style="font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: #8b5cf6; padding: 0 30px; margin-bottom: 15px;">Post-Completion</div>
                <div class="nav-item" onclick="showView('homeowner')">🏡 Homeowner Hub</div>
                <div class="nav-item" onclick="showView('landlord')">🏢 Landlord Hub</div>
            </div>
        </nav>
        
        <main class="main-content">
            <!-- Dashboard View -->
            <div id="dashboard" class="view active">
                <div class="page-header">
                    <div class="page-title">45 Oak Avenue, Manchester</div>
                    <div class="page-subtitle">Purchase price: £285,000 · Expected completion: 15 November 2025</div>
                </div>
                
                <!-- ENHANCEMENT: Dynamic alert system -->
                <div class="alert" id="main-alert">
                    <strong>New update:</strong> Your solicitor has received the draft contract. Review required by Friday.
                </div>
                
                <div class="progress-section">
                    <div class="progress-header">
                        <div class="progress-title">Sale Progress</div>
                        <div class="progress-percentage">65%</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <!-- ENHANCEMENT: Clear stage markers with better progress tracking -->
                    <div class="progress-stages">
                        <div class="stage-item completed" data-stage="offer">
                            <div class="stage-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                                </svg>
                            </div>
                            <div class="stage-name">Offer Accepted</div>
                            <div class="stage-date" style="font-size: 11px; color: #666; margin-top: 3px;">8 Oct 2025</div>
                        </div>
                        <div class="stage-item completed" data-stage="searches">
                            <div class="stage-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                                </svg>
                            </div>
                            <div class="stage-name">Searches Complete</div>
                            <div class="stage-date" style="font-size: 11px; color: #666; margin-top: 3px;">19 Oct 2025</div>
                        </div>
                        <div class="stage-item completed" data-stage="survey">
                            <div class="stage-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                                </svg>
                            </div>
                            <div class="stage-name">Survey Done</div>
                            <div class="stage-date" style="font-size: 11px; color: #666; margin-top: 3px;">20 Oct 2025</div>
                        </div>
                        <div class="stage-item active" data-stage="contracts">
                            <div class="stage-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                </svg>
                            </div>
                            <div class="stage-name">With Solicitors</div>
                            <div class="stage-date" style="font-size: 11px; color: #666; margin-top: 3px;">In progress</div>
                        </div>
                        <div class="stage-item" data-stage="exchange">
                            <div class="stage-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
                                </svg>
                            </div>
                            <div class="stage-name">Exchange</div>
                            <div class="stage-date" style="font-size: 11px; color: #666; margin-top: 3px;">Expected 5 Nov</div>
                        </div>
                        <div class="stage-item" data-stage="completion">
                            <div class="stage-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
                                </svg>
                            </div>
                            <div class="stage-name">Completion</div>
                            <div class="stage-date" style="font-size: 11px; color: #666; margin-top: 3px;">15 Nov 2025</div>
                        </div>
                    </div>
                </div>
                
                <!-- ENHANCEMENT: What's stuck section -->
                <div class="card" style="margin-bottom: 20px; border-left: 4px solid #f59e0b;">
                    <div class="card-title" style="color: #f59e0b;">⚠️ What's Stuck?</div>
                    <div id="stuckItems" style="font-size: 14px; line-height: 1.6;">
                        <div style="padding: 8px 0; border-bottom: 1px solid #f5f5f5;">
                            <strong>Contract review</strong> - No update in 3 days
                        </div>
                        <div style="padding: 8px 0; border-bottom: 1px solid #f5f5f5;">
                            <strong>Survey report</strong> - Expected 2 days ago
                        </div>
                        <div style="padding: 8px 0;">
                            <strong>Mortgage paperwork</strong> - Overdue by 1 day
                        </div>
                    </div>
                </div>
                
                <!-- ENHANCEMENT: Property Insights section -->
                <div class="card" style="margin-bottom: 20px;">
                    <div class="card-title">🏠 Property Insights</div>
                    <div id="propertyInsights" style="font-size: 14px; line-height: 1.6;">
                        <div style="padding: 8px 0; border-bottom: 1px solid #f5f5f5;">
                            <strong>Location:</strong> Manchester M1 2AB
                        </div>
                        <div style="padding: 8px 0; border-bottom: 1px solid #f5f5f5;">
                            <strong>Property type:</strong> Terraced house
                        </div>
                        <div style="padding: 8px 0; margin-bottom: 12px;">
                            <strong>Market trend:</strong> <span id="marketTrend">Loading...</span>
                        </div>
                        
                        <!-- ENHANCEMENT: Interactive API buttons -->
                        <div style="border-top: 1px solid #f0f0f0; padding-top: 12px;">
                            <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 8px;">
                                <button onclick="refreshPropertyData()" style="padding: 6px 12px; font-size: 12px; background: #8b5cf6; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    🔄 Refresh Data
                                </button>
                                <button onclick="getLocationInfo()" style="padding: 6px 12px; font-size: 12px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    📍 Get Location Info
                                </button>
                                <button onclick="getWeatherInfo()" style="padding: 6px 12px; font-size: 12px; background: #22c55e; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    🌤️ Get Weather
                                </button>
                            </div>
                            <div id="apiResults" style="font-size: 12px; color: #666; min-height: 20px;">
                                Click buttons above to fetch real data
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ENHANCEMENT: Next Steps section -->
                <div class="card" style="margin-bottom: 20px;">
                    <div class="card-title">📋 Next Steps</div>
                    <div id="nextSteps" style="font-size: 14px; line-height: 1.6;">
                        <div style="padding: 8px 0; border-bottom: 1px solid #f5f5f5;">
                            <strong>Review contract terms</strong> - Due in 3 days
                        </div>
                        <div style="padding: 8px 0; border-bottom: 1px solid #f5f5f5;">
                            <strong>Submit mortgage documents</strong> - Due in 5 days
                        </div>
                        <div style="padding: 8px 0;">
                            <strong>Book survey appointment</strong> - Due in 7 days
                        </div>
                    </div>
                </div>
                
                <!-- ENHANCEMENT: Postcode Input Section -->
                <div class="card" style="margin-bottom: 20px;">
                    <div class="card-title">📍 Change Property Location</div>
                    <div style="font-size: 14px; line-height: 1.6;">
                        <div style="margin-bottom: 12px; color: #666;">
                            Enter any UK postcode to get real property data:
                        </div>
                        <div style="display: flex; gap: 8px; margin-bottom: 12px; align-items: center;">
                            <input type="text" id="postcodeInput" placeholder="Enter UK postcode (e.g. M1 2AB)" 
                                   style="flex: 1; padding: 8px 12px; border: 1px solid #e5e5e5; border-radius: 6px; font-size: 14px;"
                                   value="M1 2AB">
                            <button onclick="updatePropertyLocation()" style="padding: 8px 16px; font-size: 14px; background: #8b5cf6; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                🔄 Update Location
                            </button>
                        </div>
                        <div id="locationUpdateResults" style="background: #f8f9fa; padding: 12px; border-radius: 6px; font-size: 12px; color: #666; min-height: 40px; border: 1px solid #e5e5e5;">
                            Current location: Manchester M1 2AB - Click "Update Location" to change
                        </div>
                        
                        <!-- ENHANCEMENT: Property-specific data for the postcode -->
                        <div id="postcodePropertyData" style="margin-top: 12px; padding: 12px; background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 6px; font-size: 12px;">
                            <div style="font-weight: 600; margin-bottom: 8px; color: #0369a1;">🏠 Property Data for ${currentPostcode}</div>
                            <div id="propertyDataContent" style="color: #666;">
                                Loading property data...
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ENHANCEMENT: API Testing Section -->
                <div class="card" style="margin-bottom: 20px;">
                    <div class="card-title">🔌 API Testing</div>
                    <div style="font-size: 14px; line-height: 1.6;">
                        <div style="margin-bottom: 12px; color: #666;">
                            Test real APIs that work directly in your browser:
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                            <button onclick="testPostcodesAPI()" style="padding: 8px 12px; font-size: 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                📍 Test Postcodes.io
                            </button>
                            <button onclick="testWeatherAPI()" style="padding: 8px 12px; font-size: 12px; background: #22c55e; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                🌤️ Test Weather API
                            </button>
                            <button onclick="testPropertyAPI()" style="padding: 8px 12px; font-size: 12px; background: #8b5cf6; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                🏠 Test Property API
                            </button>
                            <button onclick="testAllAPIs()" style="padding: 8px 12px; font-size: 12px; background: #f59e0b; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                🚀 Test All APIs
                            </button>
                        </div>
                        <div id="apiTestResults" style="background: #f8f9fa; padding: 12px; border-radius: 6px; font-size: 12px; color: #666; min-height: 60px; border: 1px solid #e5e5e5;">
                            Click any button above to test the APIs and see real data...
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="card">
                        <div class="card-title">Recent Activity</div>
                        <div class="timeline">
                            <div class="timeline-item new">
                                <div class="timeline-date">Today, 14:23</div>
                                <div class="timeline-title">Contract received</div>
                                <div class="timeline-content">Your solicitor has received the draft contract and will review within 48 hours.</div>
                            </div>
                            <div class="timeline-item new">
                                <div class="timeline-date">Yesterday, 09:15</div>
                                <div class="timeline-title">Survey report ready</div>
                                <div class="timeline-content">No major issues found. Minor recommendation for gutter maintenance.</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-date">18 Oct, 16:40</div>
                                <div class="timeline-title">Mortgage offer issued</div>
                                <div class="timeline-content">Barclays has issued your mortgage offer for £228,000.</div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="card" style="margin-bottom: 20px;">
                            <div class="card-title">Next Steps</div>
                            <div style="font-size: 14px; font-weight: 300; line-height: 1.8;">
                                <div style="margin-bottom: 12px;">✓ Review draft contract by Friday</div>
                                <div style="margin-bottom: 12px;">✓ Final mortgage paperwork to sign</div>
                                <div>○ Book removals company</div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-title">Financial Summary</div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px; font-weight: 300;">
                                <span>Purchase price</span>
                                <span style="font-weight: 400;">£285,000</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px; font-weight: 300;">
                                <span>Total fees paid</span>
                                <span style="font-weight: 400;">£3,847</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 14px; font-weight: 300;">
                                <span>Total cost</span>
                                <span style="font-weight: 400;">£288,847</span>
                            </div>
                            
                            <!-- ENHANCEMENT: Land Registry market data -->
                            <div style="border-top: 1px solid #f0f0f0; padding-top: 12px; margin-top: 12px;">
                                <div style="font-weight: 600; margin-bottom: 8px; color: #8b5cf6; font-size: 13px;">📊 Market Data</div>
                                <div id="propertyMarketData" style="font-size: 12px; color: #666; line-height: 1.4;">
                                    <div style="margin-bottom: 4px;">Loading market data...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Timeline View -->
            <div id="timeline" class="view">
                <div class="page-header">
                    <div class="page-title">Live Timeline</div>
                    <div class="page-subtitle">Real-time updates from everyone involved in your purchase</div>
                    <!-- ENHANCEMENT: Timeline controls -->
                    <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; align-items: center;">
                        <button class="btn btn-primary" onclick="openUpdateModal()" style="font-size: 14px; padding: 10px 20px;">
                            ＋ Add Update
                        </button>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="timelineSearch" placeholder="Search timeline..." style="padding: 8px 12px; border: 1px solid #e5e5e5; border-radius: 6px; font-size: 13px; width: 200px;" onkeyup="filterTimeline()">
                            <select id="timelineFilter" onchange="filterTimeline()" style="padding: 8px 12px; border: 1px solid #e5e5e5; border-radius: 6px; font-size: 13px; background: #fff;">
                                <option value="all">All Updates</option>
                                <option value="pending">Pending</option>
                                <option value="sent">Sent</option>
                                <option value="received">Received</option>
                                <option value="done">Done</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="timeline" id="timeline-container">
                    <!-- ENHANCEMENT: Enhanced timeline with status badges and actions -->
                    <div class="timeline-item new">
                        <div class="timeline-date">Today, 14:23</div>
                        <div class="timeline-title">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="display: inline-block; margin-right: 8px; color: #8b5cf6;">
                                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                            </svg>
                            Contract received by solicitor
                            <span class="status-badge status-received">Received</span>
                        </div>
                        <div class="timeline-content">
                            Emma Wilson (your solicitor) has received the draft contract from the seller's solicitor. 
                            She will review it within 48 hours and highlight any concerns.
                        </div>
                        <div class="timeline-actions">
                            <button class="timeline-action" onclick="editTimelineItem(this)">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 4px;">
                                    <path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"/>
                                </svg>
                                Edit
                            </button>
                            <button class="timeline-action" onclick="deleteTimelineItem(this)">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 4px;">
                                    <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/>
                                </svg>
                                Delete
                            </button>
                        </div>
                    </div>
                    
                    <div class="timeline-item new">
                        <div class="timeline-date">Today, 09:42</div>
                        <div class="timeline-title">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="display: inline-block; margin-right: 8px; color: #3b82f6;">
                                <path d="M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4A2,2 0 0,0 20,2M20,16H6L4,18V4H20V16Z"/>
                            </svg>
                            Message from estate agent
                        </div>
                        <div class="timeline-content">
                            "Good news - the seller has confirmed they can be flexible on the completion date if needed."
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-date">Yesterday, 14:15</div>
                        <div class="timeline-title">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="display: inline-block; margin-right: 8px; color: #22c55e;">
                                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                            </svg>
                            Survey report uploaded
                        </div>
                        <div class="timeline-content">
                            HomeSurvey Ltd has completed the Level 2 survey. No major structural issues identified.
                            Minor recommendation: gutter cleaning and repointing needed on north wall (£300-500).
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-date">19 Oct, 11:30</div>
                        <div class="timeline-title">🔍 Searches completed</div>
                        <div class="timeline-content">
                            Local authority searches completed. No planning applications nearby. Property not in flood risk area.
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-date">18 Oct, 16:40</div>
                        <div class="timeline-title">✅ Mortgage offer issued</div>
                        <div class="timeline-content">
                            Barclays Bank has issued your formal mortgage offer for £228,000 at 4.5% fixed for 5 years.
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-date">15 Oct, 09:15</div>
                        <div class="timeline-title">🏠 Valuation complete</div>
                        <div class="timeline-content">
                            Bank valuation completed at £285,000. Mortgage can proceed.
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-date">10 Oct, 15:20</div>
                        <div class="timeline-title">📝 Solicitor instructed</div>
                        <div class="timeline-content">
                            Wilson & Partners Solicitors confirmed as your conveyancer. Emma Wilson assigned as your case handler.
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-date">8 Oct, 11:45</div>
                        <div class="timeline-title">🎉 Offer accepted</div>
                        <div class="timeline-content">
                            Your offer of £285,000 has been accepted by the seller. Sale agreed!
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Team View -->
            <div id="team" class="view">
                <div class="page-header">
                    <div class="page-title">Your Team</div>
                    <div class="page-subtitle">Everyone working on your property purchase, all in one place</div>
                    <!-- ENHANCEMENT: Add person button for communication layer -->
                    <button class="btn btn-primary" onclick="openAddPersonModal()" style="margin-top: 15px; font-size: 14px; padding: 10px 20px;">
                        ＋ Add Person
                    </button>
                </div>
                
                <div class="people-grid">
                    <div class="person-card" data-person-id="1">
                        <div class="person-header">
                            <div>
                                <div class="person-role">Your Solicitor</div>
                                <div class="person-name">Emma Wilson</div>
                                <div class="person-company">Wilson & Partners</div>
                                <!-- ENHANCEMENT: Last contacted tracking -->
                                <div class="person-last-contact" style="font-size: 12px; color: #666; margin-top: 5px;">
                                    Last contacted: <span id="last-contact-1">2 days ago</span>
                                </div>
                            </div>
                            <div class="person-status">Active</div>
                        </div>
                        <div class="person-actions">
                            <button class="btn-small" onclick="logContact(1)">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 6px;">
                                    <path d="M6.62,10.79C8.06,13.62 10.38,15.94 13.21,17.38L15.41,15.18C15.69,14.9 16.08,14.82 16.43,14.93C17.55,15.3 18.75,15.5 20,15.5A1,1 0 0,1 21,16.5V20A1,1 0 0,1 20,21A17,17 0 0,1 3,4A1,1 0 0,1 4,3H7.5A1,1 0 0,1 8.5,4C8.5,5.25 8.7,6.45 9.07,7.57C9.18,7.92 9.1,8.31 8.82,8.59L6.62,10.79Z"/>
                                </svg>
                                Log Call
                            </button>
                            <button class="btn-small" onclick="logMessage(1)">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 6px;">
                                    <path d="M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4A2,2 0 0,0 20,2M20,16H6L4,18V4H20V16Z"/>
                                </svg>
                                Log Message
                            </button>
                            <button class="btn-small" onclick="editPerson(1)">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 6px;">
                                    <path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"/>
                                </svg>
                                Edit
                            </button>
                        </div>
                    </div>
                    
                    <div class="person-card">
                        <div class="person-header">
                            <div>
                                <div class="person-role">Estate Agent</div>
                                <div class="person-name">James Parker</div>
                                <div class="person-company">Parker & Co Estate Agents</div>
                            </div>
                            <div class="person-status">Active</div>
                        </div>
                        <div class="person-actions">
                            <button class="btn-small">📞 Call</button>
                            <button class="btn-small">💬 Message</button>
                        </div>
                    </div>
                    
                    <div class="person-card">
                        <div class="person-header">
                            <div>
                                <div class="person-role">Mortgage Broker</div>
                                <div class="person-name">Rachel Chen</div>
                                <div class="person-company">Manchester Mortgage Solutions</div>
                            </div>
                            <div class="person-status">Active</div>
                        </div>
                        <div class="person-actions">
                            <button class="btn-small">📞 Call</button>
                            <button class="btn-small">💬 Message</button>
                        </div>
                    </div>
                    
                    <div class="person-card">
                        <div class="person-header">
                            <div>
                                <div class="person-role">Surveyor</div>
                                <div class="person-name">David Hughes</div>
                                <div class="person-company">HomeSurvey Ltd</div>
                            </div>
                            <div class="person-status" style="background: #22c55e;">Complete</div>
                        </div>
                        <div class="person-actions">
                            <button class="btn-small">📄 View Report</button>
                        </div>
                    </div>
                    
                    <div class="person-card">
                        <div class="person-header">
                            <div>
                                <div class="person-role">Seller's Solicitor</div>
                                <div class="person-name">Michael Brown</div>
                                <div class="person-company">Brown Legal Services</div>
                            </div>
                            <div class="person-status">Active</div>
                        </div>
                        <div class="person-actions">
                            <button class="btn-small">ℹ️ View Details</button>
                        </div>
                    </div>
                    
                    <div class="person-card">
                        <div class="person-header">
                            <div>
                                <div class="person-role">Lender</div>
                                <div class="person-name">Barclays Bank</div>
                                <div class="person-company">Mortgage Department</div>
                            </div>
                            <div class="person-status" style="background: #22c55e;">Approved</div>
                        </div>
                        <div class="person-actions">
                            <button class="btn-small">📄 View Offer</button>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info" style="margin-top: 30px;">
                    💡 <strong>All your team can see this timeline</strong> — no more chasing for updates. Everyone stays in sync.
                </div>
            </div>
            
            <!-- Fees View -->
            <div id="fees" class="view">
                <div class="page-header">
                    <div class="page-title">Fees & Costs</div>
                    <div class="page-subtitle">Complete transparency — no hidden charges</div>
                </div>
                
                <div class="fee-summary">
                    <div class="fee-total">
                        <span>Total Fees</span>
                        <span>£3,847</span>
                    </div>
                    <div class="fee-subtitle">All fees are fixed and guaranteed — no surprises</div>
                </div>
                
                <div class="card">
                    <div class="card-title">Legal & Conveyancing</div>
                    <div class="fee-list">
                        <div class="fee-item">
                            <div class="fee-info">
                                <div class="fee-name">Solicitor Fees</div>
                                <div class="fee-description">Includes all conveyancing work, searches, and Land Registry fees</div>
                                <div class="fee-paid">✓ Paid 10 Oct 2025</div>
                            </div>
                            <div class="fee-amount">£1,500</div>
                        </div>
                        
                        <div class="fee-item">
                            <div class="fee-info">
                                <div class="fee-name">Stamp Duty</div>
                                <div class="fee-description">SDLT on purchase price of £285,000 (first-time buyer relief applied)</div>
                                <div class="fee-paid">✓ Paid 12 Oct 2025</div>
                            </div>
                            <div class="fee-amount">£0</div>
                        </div>
                        
                        <div class="fee-item">
                            <div class="fee-info">
                                <div class="fee-name">Land Registry</div>
                                <div class="fee-description">Registration of new ownership</div>
                            </div>
                            <div class="fee-amount">£270</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">Survey & Valuation</div>
                    <div class="fee-list">
                        <div class="fee-item">
                            <div class="fee-info">
                                <div class="fee-name">Level 2 Survey</div>
                                <div class="fee-description">HomeBuyer Report including valuation</div>
                                <div class="fee-paid">✓ Paid 13 Oct 2025</div>
                            </div>
                            <div class="fee-amount">£550</div>
                        </div>
                        
                        <div class="fee-item">
                            <div class="fee-info">
                                <div class="fee-name">Bank Valuation</div>
                                <div class="fee-description">Mortgage lender valuation fee</div>
                                <div class="fee-paid">✓ Paid 14 Oct 2025</div>
                            </div>
                            <div class="fee-amount">£0</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">Other Costs</div>
                    <div class="fee-list">
                        <div class="fee-item">
                            <div class="fee-info">
                                <div class="fee-name">Mortgage Arrangement Fee</div>
                                <div class="fee-description">Lender product fee (can be added to mortgage)</div>
                                <div class="fee-paid">✓ Paid 15 Oct 2025</div>
                            </div>
                            <div class="fee-amount">£999</div>
                        </div>
                        
                        <div class="fee-item">
                            <div class="fee-info">
                                <div class="fee-name">Broker Fee</div>
                                <div class="fee-description">Mortgage advisory service</div>
                                <div class="fee-paid">✓ Paid 16 Oct 2025</div>
                            </div>
                            <div class="fee-amount">£500</div>
                        </div>
                        
                        <div class="fee-item">
                            <div class="fee-info">
                                <div class="fee-name">HomeClear Platform</div>
                                <div class="fee-description">Real-time tracking, document storage, and team coordination</div>
                            </div>
                            <div class="fee-amount">£28</div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-success">
                    ✓ <strong>All fees locked in</strong> — these prices are guaranteed and won't change
                </div>
            </div>
            
            <!-- Messages View -->
            <div id="messages" class="view">
                <div class="page-header">
                    <div class="page-title">Messages</div>
                    <div class="page-subtitle">All conversations in one place — no more lost emails</div>
                </div>
                
                <div class="messages-container">
                    <div class="messages-list">
                        <div class="message-preview active unread">
                            <div class="message-sender">Emma Wilson (Solicitor)</div>
                            <div class="message-excerpt">I've reviewed the draft contract and have a few minor queries...</div>
                            <div class="message-time">14:23 today</div>
                        </div>
                        <div class="message-preview">
                            <div class="message-sender">James Parker (Agent)</div>
                            <div class="message-excerpt">Good news on the completion date flexibility!</div>
                            <div class="message-time">09:42 today</div>
                        </div>
                        <div class="message-preview">
                            <div class="message-sender">Rachel Chen (Broker)</div>
                            <div class="message-excerpt">Your mortgage offer has been issued by Barclays</div>
                            <div class="message-time">Yesterday</div>
                        </div>
                        <div class="message-preview">
                            <div class="message-sender">David Hughes (Surveyor)</div>
                            <div class="message-excerpt">Survey complete - report now available to view</div>
                            <div class="message-time">19 Oct</div>
                        </div>
                    </div>
                    
                    <div class="message-content">
                        <div class="message-header">
                            <div style="font-size: 16px; font-weight: 400;">Emma Wilson</div>
                            <div style="font-size: 13px; color: #666; font-weight: 300;">Your Solicitor • Wilson & Partners</div>
                        </div>
                        
                        <div class="message-thread">
                            <div class="message-bubble">
                                <div style="font-size: 13px; margin-bottom: 5px; opacity: 0.7;">10 Oct, 15:30</div>
                                <div style="font-size: 14px; font-weight: 300;">
                                    Hi Sarah, I'm Emma from Wilson & Partners. I've been assigned to handle your purchase of 45 Oak Avenue. 
                                    Looking forward to working with you!
                                </div>
                            </div>
                            
                            <div class="message-bubble sent">
                                <div style="font-size: 13px; margin-bottom: 5px; opacity: 0.7;">10 Oct, 16:15</div>
                                <div style="font-size: 14px; font-weight: 300;">
                                    Thanks Emma! Great to meet you. Looking forward to getting this moving.
                                </div>
                            </div>
                            
                            <div class="message-bubble">
                                <div style="font-size: 13px; margin-bottom: 5px; opacity: 0.7;">Today, 14:23</div>
                                <div style="font-size: 14px; font-weight: 300;">
                                    Hi Sarah, I've just received and reviewed the draft contract. Overall it looks good! 
                                    I have a couple of minor queries about the fixtures and fittings list that I'll raise 
                                    with the seller's solicitor. Should have clarity by end of week. I'll keep you posted!
                                </div>
                            </div>
                        </div>
                        
                        <div class="message-input-area">
                            <input type="text" class="message-input" placeholder="Type your message...">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Documents View -->
            <div id="documents" class="view">
                <div class="page-header">
                    <div class="page-title">Documents</div>
                    <div class="page-subtitle">All your property documents, securely stored</div>
                </div>
                
                <div class="card">
                    <div class="card-title">Contract & Legal</div>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid #e5e5e5;">
                            <div>
                                <div style="font-size: 15px; font-weight: 400; margin-bottom: 3px;">Draft Contract</div>
                                <div style="font-size: 12px; color: #666; font-weight: 300;">Uploaded today at 14:20</div>
                            </div>
                            <button class="btn-small">Download PDF</button>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid #e5e5e5;">
                            <div>
                                <div style="font-size: 15px; font-weight: 400; margin-bottom: 3px;">Title Deeds</div>
                                <div style="font-size: 12px; color: #666; font-weight: 300;">Uploaded 19 Oct</div>
                            </div>
                            <button class="btn-small">Download PDF</button>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid #e5e5e5;">
                            <div>
                                <div style="font-size: 15px; font-weight: 400; margin-bottom: 3px;">Local Searches</div>
                                <div style="font-size: 12px; color: #666; font-weight: 300;">Uploaded 19 Oct</div>
                            </div>
                            <button class="btn-small">Download PDF</button>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">Survey & Reports</div>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid #e5e5e5;">
                            <div>
                                <div style="font-size: 15px; font-weight: 400; margin-bottom: 3px;">HomeBuyer Survey Report</div>
                                <div style="font-size: 12px; color: #666; font-weight: 300;">Uploaded 20 Oct</div>
                            </div>
                            <button class="btn-small">Download PDF</button>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid #e5e5e5;">
                            <div>
                                <div style="font-size: 15px; font-weight: 400; margin-bottom: 3px;">EPC Certificate</div>
                                <div style="font-size: 12px; color: #666; font-weight: 300;">Uploaded 12 Oct</div>
                            </div>
                            <button class="btn-small">Download PDF</button>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">Mortgage Documents</div>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid #e5e5e5;">
                            <div>
                                <div style="font-size: 15px; font-weight: 400; margin-bottom: 3px;">Mortgage Offer Letter</div>
                                <div style="font-size: 12px; color: #666; font-weight: 300;">Uploaded 18 Oct</div>
                            </div>
                            <button class="btn-small">Download PDF</button>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid #e5e5e5;">
                            <div>
                                <div style="font-size: 15px; font-weight: 400; margin-bottom: 3px;">Mortgage Illustration</div>
                                <div style="font-size: 12px; color: #666; font-weight: 300;">Uploaded 5 Oct</div>
                            </div>
                            <button class="btn-small">Download PDF</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tradespeople View -->
            <div id="tradespeople" class="view">
                <div class="page-header">
                    <div class="page-title">Find Tradespeople</div>
                    <div class="page-subtitle">Vetted, reviewed, and guaranteed — no more cowboys</div>
                </div>
                
                <div class="alert">
                    💡 Based on your survey report, we recommend: <strong>Gutter cleaning & repointing</strong>
                </div>
                
                <div class="trade-filters">
                    <button class="filter-btn active">All Trades</button>
                    <button class="filter-btn">Plumbers</button>
                    <button class="filter-btn">Electricians</button>
                    <button class="filter-btn">Builders</button>
                    <button class="filter-btn">Decorators</button>
                    <button class="filter-btn">Roofers</button>
                </div>
                
                <div class="trade-card">
                    <div class="trade-header">
                        <div class="trade-info">
                            <div class="trade-name">Manchester Building Services</div>
                            <div class="trade-specialty">Roofing, Repointing & Guttering</div>
                            <div class="trade-rating">★★★★★ 4.9 (127 reviews)</div>
                        </div>
                        <div class="verified-badge">✓ Verified</div>
                    </div>
                    <div class="trade-details">
                        <span>📍 2.3 miles away</span>
                        <span>💷 Avg quote: £450</span>
                        <span>📅 Available this week</span>
                        <span>🛡️ £5M insurance</span>
                    </div>
                    <div class="trade-actions">
                        <button class="btn btn-primary">Request Quote</button>
                        <button class="btn btn-secondary">View Profile</button>
                    </div>
                </div>
                
                <div class="trade-card">
                    <div class="trade-header">
                        <div class="trade-info">
                            <div class="trade-name">Elite Plumbing & Heating</div>
                            <div class="trade-specialty">Boiler Installation, Gas Safety & Repairs</div>
                            <div class="trade-rating">★★★★★ 4.8 (89 reviews)</div>
                        </div>
                        <div class="verified-badge">✓ Verified</div>
                    </div>
                    <div class="trade-details">
                        <span>📍 1.8 miles away</span>
                        <span>💷 Avg quote: £850</span>
                        <span>📅 Available next week</span>
                        <span>🛡️ Gas Safe registered</span>
                    </div>
                    <div class="trade-actions">
                        <button class="btn btn-primary">Request Quote</button>
                        <button class="btn btn-secondary">View Profile</button>
                    </div>
                </div>
                
                <div class="trade-card">
                    <div class="trade-header">
                        <div class="trade-info">
                            <div class="trade-name">Bright Spark Electrical</div>
                            <div class="trade-specialty">Rewiring, Fuse Boxes & Electrical Safety</div>
                            <div class="trade-rating">★★★★★ 4.9 (156 reviews)</div>
                        </div>
                        <div class="verified-badge">✓ Verified</div>
                    </div>
                    <div class="trade-details">
                        <span>📍 3.1 miles away</span>
                        <span>💷 Avg quote: £650</span>
                        <span>📅 Available tomorrow</span>
                        <span>🛡️ NICEIC certified</span>
                    </div>
                    <div class="trade-actions">
                        <button class="btn btn-primary">Request Quote</button>
                        <button class="btn btn-secondary">View Profile</button>
                    </div>
                </div>
                
                <div class="alert alert-success">
                    🛡️ <strong>HomeClear Guarantee:</strong> All tradespeople are background-checked, fully insured, and work is guaranteed for 12 months
                </div>
            </div>
            
            <!-- Checklist View -->
            <div id="checklist" class="view">
                <div class="page-header">
                    <div class="page-title">Move-In Checklist</div>
                    <div class="page-subtitle">We'll help you set everything up after completion — no stress</div>
                </div>
                
                <div class="alert">
                    📅 <strong>Move-in date:</strong> 15 November 2025 · We'll send reminders at the right time
                </div>
                
                <div class="card">
                    <div class="card-title">Before Moving In</div>
                    <div class="checklist">
                        <div class="checklist-item completed" onclick="toggleChecklist(this)">
                            <div class="checklist-checkbox">✓</div>
                            <div class="checklist-text">Book removals company</div>
                        </div>
                        <div class="checklist-item completed" onclick="toggleChecklist(this)">
                            <div class="checklist-checkbox">✓</div>
                            <div class="checklist-text">Arrange home insurance (starts 15 Nov)</div>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklist(this)">
                            <div class="checklist-checkbox"></div>
                            <div class="checklist-text">Set up mail redirect with Royal Mail</div>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklist(this)">
                            <div class="checklist-checkbox"></div>
                            <div class="checklist-text">Update address with bank and DVLA</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">First Week Tasks</div>
                    <div class="checklist">
                        <div class="checklist-item" onclick="toggleChecklist(this)">
                            <div class="checklist-checkbox"></div>
                            <div class="checklist-text">Register for Council Tax (we'll help you do this)</div>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklist(this)">
                            <div class="checklist-checkbox"></div>
                            <div class="checklist-text">Set up electricity account (we've found you the best deals)</div>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklist(this)">
                            <div class="checklist-checkbox"></div>
                            <div class="checklist-text">Set up gas account</div>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklist(this)">
                            <div class="checklist-checkbox"></div>
                            <div class="checklist-text">Set up water account</div>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklist(this)">
                            <div class="checklist-checkbox"></div>
                            <div class="checklist-text">Arrange broadband installation</div>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklist(this)">
                            <div class="checklist-checkbox"></div>
                            <div class="checklist-text">Register with local GP and dentist</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">First Month</div>
                    <div class="checklist">
                        <div class="checklist-item" onclick="toggleChecklist(this)">
                            <div class="checklist-checkbox"></div>
                            <div class="checklist-text">Book boiler service</div>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklist(this)">
                            <div class="checklist-checkbox"></div>
                            <div class="checklist-text">Test smoke alarms and CO detectors</div>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklist(this)">
                            <div class="checklist-checkbox"></div>
                            <div class="checklist-text">Locate stopcock and fuse box</div>
                        </div>
                        <div class="checklist-item" onclick="toggleChecklist(this)">
                            <div class="checklist-checkbox"></div>
                            <div class="checklist-text">Change locks (if needed)</div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-success">
                    🎉 <strong>HomeClear Concierge:</strong> We can set up utilities and services for you — just ask!
                </div>
            </div>
            
            <!-- Property Search & Valuation View -->
            <div id="property-search" class="view">
                <div class="page-header">
                    <div class="page-title">🔍 Property Search & Valuation</div>
                    <div class="page-subtitle">Find properties and get instant valuations</div>
                </div>
                
                <!-- Property Search Section -->
                <div class="card" style="margin-bottom: 20px;">
                    <div class="card-title">📍 Search Properties</div>
                    <div style="display: flex; gap: 12px; margin-bottom: 16px; align-items: center;">
                        <input type="text" id="propertySearchInput" placeholder="Enter postcode or address (e.g. M1 2AB)" 
                               style="flex: 1; padding: 12px 16px; border: 1px solid #e5e5e5; border-radius: 8px; font-size: 14px;">
                        <button onclick="searchProperties()" style="padding: 12px 20px; font-size: 14px; background: #8b5cf6; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            🔍 Search
                        </button>
                    </div>
                    <div id="searchResults" style="min-height: 100px; border: 1px solid #f0f0f0; border-radius: 8px; padding: 16px; background: #fafafa;">
                        <div style="text-align: center; color: #666; font-size: 14px;">
                            Enter a postcode to search for properties and get valuations
                        </div>
                    </div>
                </div>
                
                <!-- Property Valuation Section -->
                <div class="card" style="margin-bottom: 20px;">
                    <div class="card-title">💰 Property Valuation</div>
                    <div id="valuationResults" style="min-height: 200px; border: 1px solid #f0f0f0; border-radius: 8px; padding: 16px; background: #fafafa;">
                        <div style="text-align: center; color: #666; font-size: 14px;">
                            Search for a property to see valuation and market analysis
                        </div>
                    </div>
                </div>
                
                <!-- Market Analysis Section -->
                <div class="card">
                    <div class="card-title">📊 Market Analysis</div>
                    <div id="marketAnalysis" style="min-height: 150px; border: 1px solid #f0f0f0; border-radius: 8px; padding: 16px; background: #fafafa;">
                        <div style="text-align: center; color: #666; font-size: 14px;">
                            Market analysis will appear after property search
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Homeowner Hub View -->
            <div id="homeowner" class="view">
                <div class="page-header">
                    <div class="page-title">Homeowner Hub</div>
                    <div class="page-subtitle">Keep your home running smoothly with reminders and trusted tradespeople</div>
                </div>
                
                <div class="alert">
                    🏡 You've owned 45 Oak Avenue for 3 months · Next service due: <strong>Boiler Annual Service</strong> (Dec 2025)
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div class="card">
                        <div class="card-title">Property Overview</div>
                        <div style="font-size: 14px; font-weight: 300; line-height: 1.8;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Property type</span>
                                <span style="font-weight: 400;">3-bed semi-detached</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Gas boiler age</span>
                                <span style="font-weight: 400;">5 years</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Last service</span>
                                <span style="font-weight: 400;">Dec 2024</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Insurance renewal</span>
                                <span style="font-weight: 400;">15 Nov 2026</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">Quick Actions</div>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <button class="btn btn-primary">Book Boiler Service</button>
                            <button class="btn btn-secondary">Find a Tradesperson</button>
                            <button class="btn btn-secondary">Report an Issue</button>
                        </div>
                    </div>
                </div>
                
                <div class="card" style="margin-bottom: 20px;">
                    <div class="card-title">Upcoming Maintenance</div>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div style="padding: 15px; border: 1px solid #e5e5e5; border-left: 3px solid #f59e0b;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 15px; font-weight: 400; margin-bottom: 5px;">Boiler Annual Service</div>
                                    <div style="font-size: 13px; color: #666; font-weight: 300;">Due: December 2025 • Last done: Dec 2024</div>
                                </div>
                                <button class="btn-small">Book Now</button>
                            </div>
                        </div>
                        
                        <div style="padding: 15px; border: 1px solid #e5e5e5;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 15px; font-weight: 400; margin-bottom: 5px;">Gutter Cleaning</div>
                                    <div style="font-size: 13px; color: #666; font-weight: 300;">Recommended: Spring 2026</div>
                                </div>
                                <button class="btn-small">Schedule</button>
                            </div>
                        </div>
                        
                        <div style="padding: 15px; border: 1px solid #e5e5e5;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 15px; font-weight: 400; margin-bottom: 5px;">Smoke Alarm Test</div>
                                    <div style="font-size: 13px; color: #666; font-weight: 300;">Due: Monthly check</div>
                                </div>
                                <button class="btn-small">Mark Done</button>
                            </div>
                        </div>
                        
                        <div style="padding: 15px; border: 1px solid #e5e5e5;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 15px; font-weight: 400; margin-bottom: 5px;">Home Insurance Renewal</div>
                                    <div style="font-size: 13px; color: #666; font-weight: 300;">Due: 15 Nov 2026</div>
                                </div>
                                <button class="btn-small">Compare Quotes</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">Maintenance History</div>
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-date">15 Nov 2025</div>
                            <div class="timeline-title">Property Purchase Completed</div>
                            <div class="timeline-content">Moved into 45 Oak Avenue</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-date">20 Nov 2025</div>
                            <div class="timeline-title">Locks Changed</div>
                            <div class="timeline-content">Manchester Locksmiths · £180</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-date">Dec 2024</div>
                            <div class="timeline-title">Boiler Service (Previous Owner)</div>
                            <div class="timeline-content">Gas Safe certificate on file</div>
                        </div>
                    </div>
                </div>
                
                <div class="alert" style="margin-top: 30px;">
                    💡 <strong>Pro tip:</strong> Set up automatic reminders for all your home maintenance — we'll never let you forget
                </div>
            </div>
            
            <!-- Landlord Hub View -->
            <div id="landlord" class="view">
                <div class="page-header">
                    <div class="page-title">Landlord Hub</div>
                    <div class="page-subtitle">Manage your rental property, tenant, and compliance — all in one place</div>
                </div>
                
                <div class="alert alert-info">
                    🏢 <strong>Property:</strong> 45 Oak Avenue · <strong>Tenant:</strong> Emma Rodriguez · <strong>Rent:</strong> £1,250/month · <strong>Tenancy ends:</strong> 14 Nov 2026
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div class="card">
                        <div class="card-title">Rent Status</div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <span style="font-size: 14px; font-weight: 300;">October 2025</span>
                            <span style="padding: 5px 10px; background: #22c55e; color: #fff; font-size: 11px;">PAID</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; font-weight: 300;">
                            <span>Amount</span>
                            <span style="font-weight: 400;">£1,250</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 14px; font-weight: 300;">
                            <span>Paid on</span>
                            <span style="font-weight: 400;">1 Oct 2025</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">Quick Actions</div>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <button class="btn btn-secondary">💬 Message Tenant</button>
                            <button class="btn btn-secondary">📄 View Tenancy Agreement</button>
                            <button class="btn btn-secondary">🔧 Book Maintenance</button>
                        </div>
                    </div>
                </div>
                
                <div class="card" style="margin-bottom: 20px;">
                    <div class="card-title">Tenant Communications</div>
                    <div class="timeline">
                        <div class="timeline-item new">
                            <div class="timeline-date">Today, 11:30</div>
                            <div class="timeline-title">💬 Message from Emma Rodriguez</div>
                            <div class="timeline-content">
                                "Hi, the kitchen tap is dripping quite badly. Could you arrange for someone to take a look? Thanks!"
                            </div>
                            <button class="btn-small" style="margin-top: 10px;">Reply</button>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-date">1 Oct, 09:15</div>
                            <div class="timeline-title">✅ Rent Payment Received</div>
                            <div class="timeline-content">£1,250 received via standing order</div>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-date">28 Sep, 14:20</div>
                            <div class="timeline-title">📋 Routine Inspection Completed</div>
                            <div class="timeline-content">Property in excellent condition. No issues noted.</div>
                        </div>
                    </div>
                </div>
                
                <div class="card" style="margin-bottom: 20px;">
                    <div class="card-title">Compliance & Certificates</div>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div style="padding: 15px; border: 1px solid #e5e5e5; border-left: 3px solid #22c55e;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 15px; font-weight: 400; margin-bottom: 5px;">✓ Gas Safety Certificate</div>
                                    <div style="font-size: 13px; color: #666; font-weight: 300;">Valid until: 14 Dec 2025</div>
                                </div>
                                <button class="btn-small">View Certificate</button>
                            </div>
                        </div>
                        
                        <div style="padding: 15px; border: 1px solid #e5e5e5; border-left: 3px solid #22c55e;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 15px; font-weight: 400; margin-bottom: 5px;">✓ EICR (Electrical Safety)</div>
                                    <div style="font-size: 13px; color: #666; font-weight: 300;">Valid until: 20 Mar 2027</div>
                                </div>
                                <button class="btn-small">View Certificate</button>
                            </div>
                        </div>
                        
                        <div style="padding: 15px; border: 1px solid #e5e5e5; border-left: 3px solid #22c55e;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 15px; font-weight: 400; margin-bottom: 5px;">✓ EPC Rating</div>
                                    <div style="font-size: 13px; color: #666; font-weight: 300;">Rating: C (Valid until 2033)</div>
                                </div>
                                <button class="btn-small">View Certificate</button>
                            </div>
                        </div>
                        
                        <div style="padding: 15px; border: 1px solid #e5e5e5; border-left: 3px solid #22c55e;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 15px; font-weight: 400; margin-bottom: 5px;">✓ Deposit Protected</div>
                                    <div style="font-size: 13px; color: #666; font-weight: 300;">TDS Scheme · £1,500 protected</div>
                                </div>
                                <button class="btn-small">View Details</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card" style="margin-bottom: 20px;">
                    <div class="card-title">Upcoming Tasks</div>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div style="padding: 15px; border: 1px solid #e5e5e5; border-left: 3px solid #ef4444;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 15px; font-weight: 400; margin-bottom: 5px;">Fix Kitchen Tap (Tenant Request)</div>
                                    <div style="font-size: 13px; color: #666; font-weight: 300;">Reported: Today · Response due within 24h</div>
                                </div>
                                <button class="btn btn-primary" style="padding: 8px 16px; font-size: 13px;">Book Plumber</button>
                            </div>
                        </div>
                        
                        <div style="padding: 15px; border: 1px solid #e5e5e5; border-left: 3px solid #f59e0b;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 15px; font-weight: 400; margin-bottom: 5px;">Gas Safety Certificate Renewal</div>
                                    <div style="font-size: 13px; color: #666; font-weight: 300;">Due: 14 Dec 2025 (56 days)</div>
                                </div>
                                <button class="btn-small">Schedule</button>
                            </div>
                        </div>
                        
                        <div style="padding: 15px; border: 1px solid #e5e5e5;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 15px; font-weight: 400; margin-bottom: 5px;">Routine Property Inspection</div>
                                    <div style="font-size: 13px; color: #666; font-weight: 300;">Next due: March 2026</div>
                                </div>
                                <button class="btn-small">Schedule</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">Financial Summary (Last 12 Months)</div>
                    <div style="font-size: 14px; font-weight: 300; line-height: 1.8;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Total rent received</span>
                            <span style="font-weight: 400;">£15,000</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Maintenance costs</span>
                            <span style="font-weight: 400;">£1,840</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Management fees</span>
                            <span style="font-weight: 400;">£0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Certificates & compliance</span>
                            <span style="font-weight: 400;">£420</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding-top: 10px; border-top: 1px solid #e5e5e5; font-weight: 400;">
                            <span>Net rental income</span>
                            <span>£12,740</span>
                        </div>
                    </div>
                    <button class="btn btn-secondary" style="width: 100%; margin-top: 15px;">Download Tax Report</button>
                </div>
                
                <div class="alert alert-success" style="margin-top: 30px;">
                    🛡️ <strong>Landlord Protection:</strong> Automated compliance tracking · 24h maintenance response · Vetted tradespeople · Deposit protection included
                </div>
            </div>
        </main>
    </div>
    
    <!-- ENHANCEMENT: Modal for adding timeline updates -->
    <div id="updateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Add Timeline Update</div>
                <span class="close" onclick="closeUpdateModal()">&times;</span>
            </div>
            <form id="updateForm">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="datetime-local" class="form-input" id="updateDate" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="updateStatus" required>
                            <option value="pending">Pending</option>
                            <option value="sent">Sent</option>
                            <option value="received">Received</option>
                            <option value="done">Done</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Who it involves</label>
                    <select class="form-select" id="updateParty" required>
                        <option value="solicitor">Solicitor</option>
                        <option value="agent">Estate Agent</option>
                        <option value="broker">Mortgage Broker</option>
                        <option value="surveyor">Surveyor</option>
                        <option value="lender">Lender</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <div style="display: flex; gap: 8px; margin-bottom: 8px; flex-wrap: wrap;">
                        <button type="button" class="template-btn" onclick="useTemplate('Contract received')">Contract received</button>
                        <button type="button" class="template-btn" onclick="useTemplate('Survey booked')">Survey booked</button>
                        <button type="button" class="template-btn" onclick="useTemplate('Chase solicitor')">Chase solicitor</button>
                        <button type="button" class="template-btn" onclick="useTemplate('Mortgage approved')">Mortgage approved</button>
                        <button type="button" class="template-btn" onclick="useTemplate('Exchange date set')">Exchange date set</button>
                    </div>
                    <input type="text" class="form-input" id="updateTitle" placeholder="Brief description of the update" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-textarea" id="updateNotes" placeholder="Additional details..."></textarea>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeUpdateModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Update</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- ENHANCEMENT: Add Person Modal -->
    <div id="addPersonModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Add Team Member</div>
                <span class="close" onclick="closeAddPersonModal()">&times;</span>
            </div>
            <form id="addPersonForm">
                <div class="form-group">
                    <label class="form-label">Role</label>
                    <select class="form-select" id="personRole" required>
                        <option value="solicitor">Solicitor</option>
                        <option value="agent">Estate Agent</option>
                        <option value="broker">Mortgage Broker</option>
                        <option value="surveyor">Surveyor</option>
                        <option value="lender">Lender</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Name</label>
                        <input type="text" class="form-input" id="personName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Company</label>
                        <input type="text" class="form-input" id="personCompany" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="personEmail">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone</label>
                        <input type="tel" class="form-input" id="personPhone">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-textarea" id="personNotes" placeholder="Any additional notes about this person..."></textarea>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeAddPersonModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Person</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- ENHANCEMENT: Notification panel -->
    <div id="notificationPanel" class="notification-panel">
        <div class="notification-header">Recent Updates</div>
        <div id="notificationList">
            <div class="notification-item unread">
                <div class="notification-title">Contract received by solicitor</div>
                <div class="notification-time">Today, 14:23</div>
                <div class="notification-content">Emma Wilson has received the draft contract and will review within 48 hours.</div>
            </div>
            <div class="notification-item unread">
                <div class="notification-title">Message from estate agent</div>
                <div class="notification-time">Today, 09:42</div>
                <div class="notification-content">Good news - the seller has confirmed they can be flexible on the completion date.</div>
            </div>
            <div class="notification-item">
                <div class="notification-title">Survey report uploaded</div>
                <div class="notification-time">Yesterday, 14:15</div>
                <div class="notification-content">HomeSurvey Ltd has completed the Level 2 survey. No major structural issues identified.</div>
            </div>
        </div>
    </div>
    
    <!-- ENHANCEMENT: Saved indicator -->
    <div id="savedIndicator" class="saved-indicator">Saved</div>
    
    <script>
        function showView(viewId) {
            // Hide all views
            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active');
            });
            
            // Show selected view
            document.getElementById(viewId).classList.add('active');
            
            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Scroll to top
            window.scrollTo(0, 0);
        }
        
        function toggleChecklist(item) {
            item.classList.toggle('completed');
        }
        
        // ENHANCEMENT: Communication layer functionality
        
        // Data management with localStorage
        function saveData() {
            const data = {
                timelineEvents: getTimelineEvents(),
                parties: getParties(),
                tasks: getTasks(),
                messages: getMessages(),
                property: getProperty()
            };
            localStorage.setItem('hc.data', JSON.stringify(data));
            showSavedIndicator();
        }
        
        function loadData() {
            const saved = localStorage.getItem('hc.data');
            if (saved) {
                const data = JSON.parse(saved);
                // Load data into the interface
                renderTimelineEvents(data.timelineEvents || []);
                renderParties(data.parties || []);
                renderTasks(data.tasks || []);
            }
        }
        
        function getTimelineEvents() {
            const events = [];
            document.querySelectorAll('#timeline-container .timeline-item').forEach(item => {
                const date = item.querySelector('.timeline-date').textContent;
                const title = item.querySelector('.timeline-title').textContent.replace(/\[.*?\]/g, '').trim();
                const content = item.querySelector('.timeline-content').textContent;
                const status = item.querySelector('.status-badge')?.textContent.toLowerCase() || 'pending';
                
                events.push({
                    id: Date.now() + Math.random(),
                    date: date,
                    title: title,
                    content: content,
                    status: status,
                    createdAt: new Date().toISOString()
                });
            });
            return events;
        }
        
        function getParties() {
            // Return default parties for now
            return [
                { id: 1, role: 'Solicitor', name: 'Emma Wilson', company: 'Wilson & Partners', email: 'emma@wilsonpartners.co.uk', phone: '0161 123 4567' },
                { id: 2, role: 'Estate Agent', name: 'James Parker', company: 'Parker & Co Estate Agents', email: 'james@parkerco.co.uk', phone: '0161 234 5678' },
                { id: 3, role: 'Mortgage Broker', name: 'Rachel Chen', company: 'Manchester Mortgage Solutions', email: 'rachel@manchestermortgages.co.uk', phone: '0161 345 6789' }
            ];
        }
        
        function getTasks() {
            return [];
        }
        
        function getMessages() {
            return [];
        }
        
        function getProperty() {
            return {
                address: '45 Oak Avenue, Manchester',
                purchasePrice: 285000,
                expectedCompletion: '15 November 2025'
            };
        }
        
        // Timeline management
        function openUpdateModal() {
            document.getElementById('updateModal').style.display = 'block';
            document.getElementById('updateDate').value = new Date().toISOString().slice(0, 16);
        }
        
        function closeUpdateModal() {
            document.getElementById('updateModal').style.display = 'none';
            document.getElementById('updateForm').reset();
        }
        
        function addTimelineUpdate(event) {
            event.preventDefault();
            
            const date = document.getElementById('updateDate').value;
            const status = document.getElementById('updateStatus').value;
            const party = document.getElementById('updateParty').value;
            const title = document.getElementById('updateTitle').value;
            const notes = document.getElementById('updateNotes').value;
            
            const timelineContainer = document.getElementById('timeline-container');
            const newItem = document.createElement('div');
            newItem.className = 'timeline-item new';
            
            const formattedDate = new Date(date).toLocaleDateString('en-GB', { 
                day: 'numeric', 
                month: 'short', 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const statusClass = `status-${status}`;
            const statusText = status.charAt(0).toUpperCase() + status.slice(1);
            
            newItem.innerHTML = `
                <div class="timeline-date">${formattedDate}</div>
                <div class="timeline-title">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="display: inline-block; margin-right: 8px; color: #8b5cf6;">
                        <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                    </svg>
                    ${title}
                    <span class="status-badge ${statusClass}">${statusText}</span>
                </div>
                <div class="timeline-content">
                    ${notes || 'No additional notes'}
                </div>
                <div class="timeline-actions">
                    <button class="timeline-action" onclick="editTimelineItem(this)">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 4px;">
                            <path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"/>
                        </svg>
                        Edit
                    </button>
                    <button class="timeline-action" onclick="deleteTimelineItem(this)">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 4px;">
                            <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/>
                        </svg>
                        Delete
                    </button>
                </div>
            `;
            
            timelineContainer.insertBefore(newItem, timelineContainer.firstChild);
            closeUpdateModal();
            saveData();
            
            // ENHANCEMENT: Add notification for new timeline update
            addNotification(`Timeline update: ${title}`, notes || 'No additional notes');
        }
        
        function editTimelineItem(button) {
            // For now, just show an alert - full edit functionality can be added later
            alert('Edit functionality coming soon! For now, you can delete and re-add the item.');
        }
        
        function deleteTimelineItem(button) {
            if (confirm('Are you sure you want to delete this timeline item?')) {
                button.closest('.timeline-item').remove();
                saveData();
            }
        }
        
        function showSavedIndicator() {
            const indicator = document.getElementById('savedIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }
        
        function renderTimelineEvents(events) {
            // ENHANCEMENT: Render timeline events from localStorage
            if (events && events.length > 0) {
                const timelineContainer = document.getElementById('timeline-container');
                // Clear existing static content except the first few items
                const staticItems = timelineContainer.querySelectorAll('.timeline-item');
                staticItems.forEach((item, index) => {
                    if (index >= 3) { // Keep first 3 static items
                        item.remove();
                    }
                });
                
                // Add events from localStorage
                events.forEach(event => {
                    const newItem = document.createElement('div');
                    newItem.className = 'timeline-item new';
                    newItem.innerHTML = `
                        <div class="timeline-date">${event.date}</div>
                        <div class="timeline-title">
                            ${event.title}
                            <span class="status-badge status-${event.status}">${event.status.charAt(0).toUpperCase() + event.status.slice(1)}</span>
                        </div>
                        <div class="timeline-content">${event.content}</div>
                        <div class="timeline-actions">
                            <button class="timeline-action" onclick="editTimelineItem(this)">✏️ Edit</button>
                            <button class="timeline-action" onclick="deleteTimelineItem(this)">🗑️ Delete</button>
                        </div>
                    `;
                    timelineContainer.appendChild(newItem);
                });
            }
        }
        
        function renderParties(parties) {
            // ENHANCEMENT: Render parties from localStorage
            if (parties && parties.length > 0) {
                const peopleGrid = document.querySelector('.people-grid');
                // Clear existing static content
                peopleGrid.innerHTML = '';
                
                parties.forEach(party => {
                    const newPersonCard = document.createElement('div');
                    newPersonCard.className = 'person-card';
                    newPersonCard.setAttribute('data-person-id', party.id);
                    
                    newPersonCard.innerHTML = `
                        <div class="person-header">
                            <div>
                                <div class="person-role">${party.role}</div>
                                <div class="person-name">${party.name}</div>
                                <div class="person-company">${party.company}</div>
                                <div class="person-last-contact" style="font-size: 12px; color: #666; margin-top: 5px;">
                                    Last contacted: <span>${party.lastContactedISO ? new Date(party.lastContactedISO).toLocaleDateString() : 'Never'}</span>
                                </div>
                            </div>
                            <div class="person-status">Active</div>
                        </div>
                        <div class="person-actions">
                            <button class="btn-small" onclick="logContact(${party.id})">📞 Log Call</button>
                            <button class="btn-small" onclick="logMessage(${party.id})">💬 Log Message</button>
                            <button class="btn-small" onclick="editPerson(${party.id})">✏️ Edit</button>
                        </div>
                    `;
                    peopleGrid.appendChild(newPersonCard);
                });
            }
        }
        
        function renderTasks(tasks) {
            // ENHANCEMENT: Render tasks from localStorage
            if (tasks && tasks.length > 0) {
                // This would update the checklist view with tasks from localStorage
                // For now, we'll keep the existing static content
            }
        }
        
        // ENHANCEMENT: Team management functions
        
        function openAddPersonModal() {
            document.getElementById('addPersonModal').style.display = 'block';
        }
        
        function closeAddPersonModal() {
            document.getElementById('addPersonModal').style.display = 'none';
            document.getElementById('addPersonForm').reset();
        }
        
        function addPerson(event) {
            event.preventDefault();
            
            const role = document.getElementById('personRole').value;
            const name = document.getElementById('personName').value;
            const company = document.getElementById('personCompany').value;
            const email = document.getElementById('personEmail').value;
            const phone = document.getElementById('personPhone').value;
            const notes = document.getElementById('personNotes').value;
            
            const peopleGrid = document.querySelector('.people-grid');
            const newPersonCard = document.createElement('div');
            newPersonCard.className = 'person-card';
            newPersonCard.setAttribute('data-person-id', Date.now());
            
            const roleDisplay = role.charAt(0).toUpperCase() + role.slice(1).replace('_', ' ');
            
            newPersonCard.innerHTML = `
                <div class="person-header">
                    <div>
                        <div class="person-role">${roleDisplay}</div>
                        <div class="person-name">${name}</div>
                        <div class="person-company">${company}</div>
                        <div class="person-last-contact" style="font-size: 12px; color: #666; margin-top: 5px;">
                            Last contacted: <span>Never</span>
                        </div>
                    </div>
                    <div class="person-status">Active</div>
                </div>
                <div class="person-actions">
                    <button class="btn-small" onclick="logContact(${Date.now()})">📞 Log Call</button>
                    <button class="btn-small" onclick="logMessage(${Date.now()})">💬 Log Message</button>
                    <button class="btn-small" onclick="editPerson(${Date.now()})">✏️ Edit</button>
                </div>
            `;
            
            peopleGrid.appendChild(newPersonCard);
            closeAddPersonModal();
            saveData();
        }
        
        function logContact(personId) {
            const now = new Date();
            const timeString = now.toLocaleDateString('en-GB', { 
                day: 'numeric', 
                month: 'short', 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const note = prompt('Add a note about this contact (optional):');
            const noteText = note ? ` - ${note}` : '';
            
            // Update the last contacted display
            const personCard = document.querySelector(`[data-person-id="${personId}"]`);
            if (personCard) {
                const lastContactSpan = personCard.querySelector('.person-last-contact span');
                if (lastContactSpan) {
                    lastContactSpan.textContent = timeString + noteText;
                }
            }
            
            // Add to timeline
            const timelineContainer = document.getElementById('timeline-container');
            const newItem = document.createElement('div');
            newItem.className = 'timeline-item new';
            
            const personName = personCard?.querySelector('.person-name')?.textContent || 'Team member';
            
            newItem.innerHTML = `
                <div class="timeline-date">${timeString}</div>
                <div class="timeline-title">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="display: inline-block; margin-right: 8px; color: #22c55e;">
                        <path d="M6.62,10.79C8.06,13.62 10.38,15.94 13.21,17.38L15.41,15.18C15.69,14.9 16.08,14.82 16.43,14.93C17.55,15.3 18.75,15.5 20,15.5A1,1 0 0,1 21,16.5V20A1,1 0 0,1 20,21A17,17 0 0,1 3,4A1,1 0 0,1 4,3H7.5A1,1 0 0,1 8.5,4C8.5,5.25 8.7,6.45 9.07,7.57C9.18,7.92 9.1,8.31 8.82,8.59L6.62,10.79Z"/>
                    </svg>
                    Called ${personName}
                    <span class="status-badge status-done">Done</span>
                </div>
                <div class="timeline-content">
                    Logged call with ${personName}${noteText}
                </div>
                <div class="timeline-actions">
                    <button class="timeline-action" onclick="editTimelineItem(this)">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 4px;">
                            <path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"/>
                        </svg>
                        Edit
                    </button>
                    <button class="timeline-action" onclick="deleteTimelineItem(this)">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 4px;">
                            <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/>
                        </svg>
                        Delete
                    </button>
                </div>
            `;
            
            timelineContainer.insertBefore(newItem, timelineContainer.firstChild);
            saveData();
        }
        
        function logMessage(personId) {
            const personCard = document.querySelector(`[data-person-id="${personId}"]`);
            const personName = personCard?.querySelector('.person-name')?.textContent || 'Team member';
            
            const subject = prompt('Message subject:');
            if (!subject) return;
            
            const message = prompt('Message content:');
            if (!message) return;
            
            const now = new Date();
            const timeString = now.toLocaleDateString('en-GB', { 
                day: 'numeric', 
                month: 'short', 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            // Update last contacted
            const lastContactSpan = personCard?.querySelector('.person-last-contact span');
            if (lastContactSpan) {
                lastContactSpan.textContent = timeString;
            }
            
            // Add to timeline
            const timelineContainer = document.getElementById('timeline-container');
            const newItem = document.createElement('div');
            newItem.className = 'timeline-item new';
            
            newItem.innerHTML = `
                <div class="timeline-date">${timeString}</div>
                <div class="timeline-title">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="display: inline-block; margin-right: 8px; color: #3b82f6;">
                        <path d="M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4A2,2 0 0,0 20,2M20,16H6L4,18V4H20V16Z"/>
                    </svg>
                    Message to ${personName}: ${subject}
                    <span class="status-badge status-sent">Sent</span>
                </div>
                <div class="timeline-content">
                    ${message}
                </div>
                <div class="timeline-actions">
                    <button class="timeline-action" onclick="editTimelineItem(this)">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 4px;">
                            <path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"/>
                        </svg>
                        Edit
                    </button>
                    <button class="timeline-action" onclick="deleteTimelineItem(this)">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 4px;">
                            <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/>
                        </svg>
                        Delete
                    </button>
                </div>
            `;
            
            timelineContainer.insertBefore(newItem, timelineContainer.firstChild);
            saveData();
        }
        
        function editPerson(personId) {
            alert('Edit person functionality coming soon! For now, you can delete and re-add the person.');
        }
        
        // ENHANCEMENT: Notification system
        
        function toggleNotifications() {
            const panel = document.getElementById('notificationPanel');
            panel.classList.toggle('show');
            
            // Mark all notifications as read when opened
            if (panel.classList.contains('show')) {
                markAllNotificationsRead();
            }
        }
        
        function markAllNotificationsRead() {
            document.querySelectorAll('.notification-item.unread').forEach(item => {
                item.classList.remove('unread');
            });
            updateNotificationBadge();
        }
        
        function updateNotificationBadge() {
            const unreadCount = document.querySelectorAll('.notification-item.unread').length;
            const badge = document.getElementById('notification-dot');
            
            if (unreadCount > 0) {
                badge.style.display = 'block';
            } else {
                badge.style.display = 'none';
            }
        }
        
        function addNotification(title, content, isUrgent = false) {
            const notificationList = document.getElementById('notificationList');
            const now = new Date();
            const timeString = now.toLocaleDateString('en-GB', { 
                day: 'numeric', 
                month: 'short', 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const newNotification = document.createElement('div');
            newNotification.className = 'notification-item unread';
            newNotification.innerHTML = `
                <div class="notification-title">${title}</div>
                <div class="notification-time">${timeString}</div>
                <div class="notification-content">${content}</div>
            `;
            
            notificationList.insertBefore(newNotification, notificationList.firstChild);
            updateNotificationBadge();
            
            // Update main alert if urgent
            if (isUrgent) {
                updateMainAlert(title, content);
            }
        }
        
        function updateMainAlert(title, content) {
            const mainAlert = document.getElementById('main-alert');
            mainAlert.innerHTML = `<strong>New update:</strong> ${title} - ${content}`;
        }
        
        // Close notification panel when clicking outside
        document.addEventListener('click', function(e) {
            const panel = document.getElementById('notificationPanel');
            const badge = document.querySelector('.notification-badge');
            
            if (!panel.contains(e.target) && !badge.contains(e.target)) {
                panel.classList.remove('show');
            }
        });
        
        // ENHANCEMENT: Progress tracking functions
        
        function updateProgressBar() {
            const stages = document.querySelectorAll('.stage-item');
            const completedStages = document.querySelectorAll('.stage-item.completed');
            const progressPercentage = Math.round((completedStages.length / stages.length) * 100);
            
            const progressFill = document.querySelector('.progress-fill');
            const progressText = document.querySelector('.progress-percentage');
            
            if (progressFill) {
                progressFill.style.width = progressPercentage + '%';
            }
            if (progressText) {
                progressText.textContent = progressPercentage + '%';
            }
        }
        
        function markStageComplete(stageName) {
            const stageElement = document.querySelector(`[data-stage="${stageName}"]`);
            if (stageElement && !stageElement.classList.contains('completed')) {
                stageElement.classList.remove('active');
                stageElement.classList.add('completed');
                stageElement.querySelector('.stage-icon').textContent = '✓';
                
                // Move active to next stage
                const nextStage = stageElement.nextElementSibling;
                if (nextStage && !nextStage.classList.contains('completed')) {
                    nextStage.classList.add('active');
                    nextStage.querySelector('.stage-icon').textContent = '⏳';
                }
                
                updateProgressBar();
                addNotification(`Stage completed: ${stageName}`, `The ${stageName} stage has been completed successfully.`);
            }
        }
        
        // ENHANCEMENT: Role-based visibility
        
        function switchRole(role) {
            const userName = document.getElementById('userName');
            const mainAlert = document.getElementById('main-alert');
            
            switch(role) {
                case 'buyer':
                    userName.textContent = 'Sarah Thompson';
                    mainAlert.innerHTML = '<strong>Your purchase:</strong> 45 Oak Avenue, Manchester · Review contract by Friday';
                    break;
                case 'solicitor':
                    userName.textContent = 'Emma Wilson';
                    mainAlert.innerHTML = '<strong>Client case:</strong> Sarah Thompson purchase · Contract review due Friday';
                    break;
                case 'agent':
                    userName.textContent = 'James Parker';
                    mainAlert.innerHTML = '<strong>Sale progress:</strong> 45 Oak Avenue · Buyer solicitor reviewing contract';
                    break;
            }
            
            // Add notification about role switch
            addNotification(`Switched to ${role} view`, `Now viewing the platform from the ${role} perspective.`);
        }
        
        // ENHANCEMENT: Timeline filtering and search
        
        function filterTimeline() {
            const searchTerm = document.getElementById('timelineSearch').value.toLowerCase();
            const statusFilter = document.getElementById('timelineFilter').value;
            const timelineItems = document.querySelectorAll('#timeline-container .timeline-item');
            
            timelineItems.forEach(item => {
                const title = item.querySelector('.timeline-title').textContent.toLowerCase();
                const content = item.querySelector('.timeline-content').textContent.toLowerCase();
                const statusBadge = item.querySelector('.status-badge');
                const itemStatus = statusBadge ? statusBadge.textContent.toLowerCase() : '';
                
                const matchesSearch = !searchTerm || title.includes(searchTerm) || content.includes(searchTerm);
                const matchesStatus = statusFilter === 'all' || itemStatus.includes(statusFilter);
                
                if (matchesSearch && matchesStatus) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        // ENHANCEMENT: Quick templates
        
        function useTemplate(template) {
            document.getElementById('updateTitle').value = template;
            
            // Auto-fill some fields based on template
            switch(template) {
                case 'Contract received':
                    document.getElementById('updateStatus').value = 'received';
                    document.getElementById('updateParty').value = 'solicitor';
                    break;
                case 'Survey booked':
                    document.getElementById('updateStatus').value = 'done';
                    document.getElementById('updateParty').value = 'surveyor';
                    break;
                case 'Chase solicitor':
                    document.getElementById('updateStatus').value = 'sent';
                    document.getElementById('updateParty').value = 'solicitor';
                    break;
                case 'Mortgage approved':
                    document.getElementById('updateStatus').value = 'done';
                    document.getElementById('updateParty').value = 'lender';
                    break;
                case 'Exchange date set':
                    document.getElementById('updateStatus').value = 'done';
                    document.getElementById('updateParty').value = 'solicitor';
                    break;
            }
        }
        
        // ENHANCEMENT: What's stuck analysis
        
        function updateStuckItems() {
            const stuckContainer = document.getElementById('stuckItems');
            if (!stuckContainer) return;
            
            const now = new Date();
            const stuckItems = [];
            
            // Analyze timeline for stuck items
            const timelineItems = document.querySelectorAll('#timeline-container .timeline-item');
            timelineItems.forEach(item => {
                const dateText = item.querySelector('.timeline-date').textContent;
                const title = item.querySelector('.timeline-title').textContent;
                const statusBadge = item.querySelector('.status-badge');
                
                if (statusBadge && statusBadge.textContent.toLowerCase() === 'pending') {
                    // This is a pending item - check if it's been too long
                    const daysSince = calculateDaysSince(dateText);
                    if (daysSince > 2) {
                        stuckItems.push({
                            title: title.replace(/\[.*?\]/g, '').trim(),
                            days: daysSince
                        });
                    }
                }
            });
            
            // Update the stuck items display
            if (stuckItems.length > 0) {
                stuckContainer.innerHTML = stuckItems.map(item => 
                    `<div style="padding: 8px 0; border-bottom: 1px solid #f5f5f5;">
                        <strong>${item.title}</strong> - No update in ${item.days} days
                    </div>`
                ).join('');
            } else {
                stuckContainer.innerHTML = '<div style="padding: 8px 0; color: #22c55e;">✅ All items on track!</div>';
            }
        }
        
        function calculateDaysSince(dateText) {
            // Simple calculation - in a real app you'd parse the actual dates
            if (dateText.includes('Today')) return 0;
            if (dateText.includes('Yesterday')) return 1;
            if (dateText.includes('2 days ago')) return 2;
            if (dateText.includes('3 days ago')) return 3;
            return 1; // Default
        }
        
        // ENHANCEMENT: Export/Import functionality
        
        function toggleDataMenu() {
            const menu = document.getElementById('dataMenu');
            menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
        }
        
        function exportData() {
            const data = {
                timelineEvents: getTimelineEvents(),
                parties: getParties(),
                tasks: getTasks(),
                messages: getMessages(),
                property: getProperty(),
                exportedAt: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `homeclear-data-${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            document.getElementById('dataMenu').style.display = 'none';
            addNotification('Data exported', 'Your HomeClear data has been downloaded.');
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            
                            // Validate data structure
                            if (data.timelineEvents || data.parties || data.tasks) {
                                // Merge with existing data
                                if (data.timelineEvents) {
                                    const existing = JSON.parse(localStorage.getItem('hc.data') || '{}');
                                    const merged = {
                                        ...existing,
                                        ...data,
                                        importedAt: new Date().toISOString()
                                    };
                                    localStorage.setItem('hc.data', JSON.stringify(merged));
                                    loadData();
                                    addNotification('Data imported', 'Your HomeClear data has been restored.');
                                }
                            } else {
                                alert('Invalid data file. Please select a valid HomeClear export file.');
                            }
                        } catch (error) {
                            alert('Error reading file. Please select a valid JSON file.');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
            document.getElementById('dataMenu').style.display = 'none';
        }
        
        // ENHANCEMENT: Next Steps management
        
        function updateNextSteps() {
            const nextStepsContainer = document.getElementById('nextSteps');
            if (!nextStepsContainer) return;
            
            const tasks = getTasks();
            const now = new Date();
            const nextWeek = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
            
            const upcomingTasks = tasks.filter(task => {
                if (task.done) return false;
                const dueDate = new Date(task.dueISO);
                return dueDate <= nextWeek;
            }).sort((a, b) => new Date(a.dueISO) - new Date(b.dueISO));
            
            if (upcomingTasks.length > 0) {
                nextStepsContainer.innerHTML = upcomingTasks.map(task => {
                    const dueDate = new Date(task.dueISO);
                    const daysUntil = Math.ceil((dueDate - now) / (1000 * 60 * 60 * 24));
                    const isOverdue = daysUntil < 0;
                    
                    return `<div style="padding: 8px 0; border-bottom: 1px solid #f5f5f5; ${isOverdue ? 'color: #dc2626;' : ''}">
                        <strong>${task.title}</strong> - ${isOverdue ? `Overdue by ${Math.abs(daysUntil)} days` : `Due in ${daysUntil} days`}
                    </div>`;
                }).join('');
            } else {
                nextStepsContainer.innerHTML = '<div style="padding: 8px 0; color: #22c55e;">✅ No upcoming tasks!</div>';
            }
        }
        
        // ENHANCEMENT: Enhanced task management
        
        function addTask(title, dueDate) {
            const tasks = getTasks();
            const newTask = {
                id: Date.now() + Math.random(),
                title: title,
                dueISO: dueDate,
                done: false,
                relatedEventId: null,
                createdAt: new Date().toISOString()
            };
            
            tasks.push(newTask);
            localStorage.setItem('hc.tasks', JSON.stringify(tasks));
            updateNextSteps();
            saveData();
        }
        
        function toggleTask(taskId) {
            const tasks = getTasks();
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.done = !task.done;
                localStorage.setItem('hc.tasks', JSON.stringify(tasks));
                updateNextSteps();
                saveData();
            }
        }
        
        // ENHANCEMENT: Land Registry API integration
        
        async function loadPropertyMarketData() {
            const marketDataContainer = document.getElementById('propertyMarketData');
            if (!marketDataContainer) return;
            
            try {
                // For demo purposes, we'll use mock data since Land Registry API requires CORS handling
                // In production, you'd use a proxy server or backend to fetch this data
                const mockData = {
                    averagePrice: 275000,
                    recentSales: 3,
                    priceChange: 2.1,
                    lastSale: '2024-08-15',
                    lastSalePrice: 280000
                };
                
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const priceDiff = 285000 - mockData.averagePrice;
                const priceDiffPercent = ((priceDiff / mockData.averagePrice) * 100).toFixed(1);
                const priceDiffText = priceDiff > 0 ? `+${priceDiffPercent}%` : `${priceDiffPercent}%`;
                const priceDiffColor = priceDiff > 0 ? '#dc2626' : '#22c55e';
                
                marketDataContainer.innerHTML = `
                    <div style="margin-bottom: 6px;">
                        <span style="font-weight: 500;">Area average:</span> £${mockData.averagePrice.toLocaleString()}
                        <span style="color: ${priceDiffColor}; margin-left: 8px;">(${priceDiffText})</span>
                    </div>
                    <div style="margin-bottom: 6px;">
                        <span style="font-weight: 500;">Recent sales:</span> ${mockData.recentSales} in last 6 months
                    </div>
                    <div style="margin-bottom: 6px;">
                        <span style="font-weight: 500;">Last sale:</span> £${mockData.lastSalePrice.toLocaleString()} (${mockData.lastSale})
                    </div>
                    <div style="font-size: 11px; color: #999; margin-top: 8px;">
                        Data from Land Registry Price Paid
                    </div>
                `;
                
            } catch (error) {
                marketDataContainer.innerHTML = `
                    <div style="color: #dc2626; font-size: 11px;">
                        Unable to load market data
                    </div>
                `;
            }
        }
        
        // Real Land Registry API integration (commented out due to CORS)
        /*
        async function fetchLandRegistryData(postcode) {
            try {
                // This would work with a backend proxy
                const response = await fetch(`/api/land-registry?postcode=${postcode}`);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Land Registry API error:', error);
                return null;
            }
        }
        */
        
        // APIs that work directly in browser (no backend needed)
        
        // 1. Postcodes.io - UK location data (FREE, no API key)
        async function fetchLocationData(postcode) {
            try {
                const response = await fetch(`https://api.postcodes.io/postcodes/${postcode}`);
                const data = await response.json();
                return data.result;
            } catch (error) {
                console.error('Postcodes.io API error:', error);
                return null;
            }
        }
        
        // 2. OpenStreetMap Nominatim - Property details (FREE, no API key)
        async function fetchPropertyDetails(address) {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&limit=1&addressdetails=1`);
                const data = await response.json();
                return data[0];
            } catch (error) {
                console.error('Nominatim API error:', error);
                return null;
            }
        }
        
        // 3. UK Government APIs - Council data (FREE, no API key)
        async function fetchCouncilData(postcode) {
            try {
                // This is a mock implementation - real UK gov APIs would work similarly
                const mockData = {
                    council: "Manchester City Council",
                    ward: "City Centre",
                    region: "North West England"
                };
                return mockData;
            } catch (error) {
                console.error('Council API error:', error);
                return null;
            }
        }
        
        // 4. Weather API - Property context (FREE with API key)
        async function fetchWeatherData(lat, lon) {
            try {
                // Using a free weather API that doesn't require CORS
                const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Weather API error:', error);
                return null;
            }
        }
        
        // Enhanced property insights with REAL APIs (no backend needed)
        async function loadPropertyInsights() {
            const marketTrendElement = document.getElementById('marketTrend');
            if (!marketTrendElement) return;
            
            try {
                // Fetch REAL data from multiple APIs
                const [locationData, propertyData, councilData, weatherData] = await Promise.all([
                    fetchLocationData('M1 2AB'),
                    fetchPropertyDetails('45 Oak Avenue, Manchester M1 2AB'),
                    fetchCouncilData('M1 2AB'),
                    fetchWeatherData(53.4808, -2.2426) // Manchester coordinates
                ]);
                
                // Update market trend with real data
                if (locationData) {
                    marketTrendElement.innerHTML = `
                        <span style="color: #22c55e;">↗️ Rising</span> 
                        <span style="font-size: 12px; color: #666;">(${locationData.region})</span>
                    `;
                } else {
                    marketTrendElement.innerHTML = '<span style="color: #22c55e;">↗️ Rising</span>';
                }
                
                // Add comprehensive property insights
                const insightsContainer = document.getElementById('propertyInsights');
                if (insightsContainer) {
                    const additionalInfo = document.createElement('div');
                    additionalInfo.style.cssText = 'padding: 8px 0; border-top: 1px solid #f5f5f5; margin-top: 8px; font-size: 12px; color: #666;';
                    
                    let infoHTML = '';
                    
                    // Location data
                    if (locationData) {
                        infoHTML += `
                            <div style="margin-bottom: 4px;"><strong>Area:</strong> ${locationData.region}</div>
                            <div style="margin-bottom: 4px;"><strong>District:</strong> ${locationData.admin_district}</div>
                            <div style="margin-bottom: 4px;"><strong>Coordinates:</strong> ${locationData.latitude.toFixed(4)}, ${locationData.longitude.toFixed(4)}</div>
                        `;
                    }
                    
                    // Property details
                    if (propertyData) {
                        infoHTML += `
                            <div style="margin-bottom: 4px;"><strong>Property type:</strong> ${propertyData.type || 'Residential'}</div>
                            <div style="margin-bottom: 4px;"><strong>OSM ID:</strong> ${propertyData.osm_id || 'N/A'}</div>
                        `;
                    }
                    
                    // Council data
                    if (councilData) {
                        infoHTML += `
                            <div style="margin-bottom: 4px;"><strong>Council:</strong> ${councilData.council}</div>
                            <div style="margin-bottom: 4px;"><strong>Ward:</strong> ${councilData.ward}</div>
                        `;
                    }
                    
                    // Weather data
                    if (weatherData && weatherData.current_weather) {
                        const temp = weatherData.current_weather.temperature;
                        const weatherCode = weatherData.current_weather.weathercode;
                        infoHTML += `
                            <div style="margin-bottom: 4px;"><strong>Current weather:</strong> ${temp}°C (Code: ${weatherCode})</div>
                        `;
                    }
                    
                    additionalInfo.innerHTML = infoHTML;
                    insightsContainer.appendChild(additionalInfo);
                }
                
            } catch (error) {
                console.error('Property insights error:', error);
                marketTrendElement.innerHTML = '<span style="color: #dc2626;">Unable to load</span>';
            }
        }
        
        // Real Land Registry data fetching (requires backend proxy)
        async function fetchRealLandRegistryData(postcode) {
            // This would be implemented with a backend service
            // that handles CORS and fetches from Land Registry API
            const backendUrl = 'https://your-backend.com/api/land-registry';
            
            try {
                const response = await fetch(`${backendUrl}?postcode=${postcode}`);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Land Registry backend error:', error);
                return null;
            }
        }
        
        // ENHANCEMENT: Postcode change functionality
        
        let currentPostcode = 'M1 2AB';
        let currentCoordinates = { lat: 53.4808, lon: -2.2426 };
        
        // Property data for different postcodes (mock data - in real app would come from APIs)
        const propertyDataByPostcode = {
            'M1 2AB': {
                area: 'Manchester City Centre',
                propertyType: 'Terraced house',
                averagePrice: 275000,
                recentSales: 3,
                councilTax: 'Band C',
                schools: 'Good primary schools nearby',
                transport: 'Metrolink tram stop 5 min walk',
                amenities: 'City centre location with shops, restaurants, bars'
            },
            'SW1A 1AA': {
                area: 'Westminster, London',
                propertyType: 'Historic building',
                averagePrice: 2500000,
                recentSales: 1,
                councilTax: 'Band H',
                schools: 'Excellent schools in Westminster',
                transport: 'Westminster tube station 2 min walk',
                amenities: 'Buckingham Palace, Houses of Parliament, St James Park'
            },
            'B1 1AA': {
                area: 'Birmingham City Centre',
                propertyType: 'Modern apartment',
                averagePrice: 180000,
                recentSales: 5,
                councilTax: 'Band B',
                schools: 'Good secondary schools in Birmingham',
                transport: 'Birmingham New Street station 10 min walk',
                amenities: 'Bullring shopping centre, restaurants, nightlife'
            },
            'L1 8JQ': {
                area: 'Liverpool Waterfront',
                propertyType: 'Warehouse conversion',
                averagePrice: 220000,
                recentSales: 2,
                councilTax: 'Band C',
                schools: 'Good schools in Liverpool city centre',
                transport: 'Liverpool Central station 15 min walk',
                amenities: 'Albert Dock, Tate Liverpool, restaurants'
            },
            'EH1 1AA': {
                area: 'Edinburgh Old Town',
                propertyType: 'Historic tenement',
                averagePrice: 320000,
                recentSales: 4,
                councilTax: 'Band D',
                schools: 'Excellent schools in Edinburgh',
                transport: 'Edinburgh Waverley station 5 min walk',
                amenities: 'Royal Mile, Edinburgh Castle, Princes Street'
            }
        };
        
        async function updatePropertyLocation() {
            const postcodeInput = document.getElementById('postcodeInput');
            const resultsDiv = document.getElementById('locationUpdateResults');
            const newPostcode = postcodeInput.value.trim();
            
            if (!newPostcode) {
                resultsDiv.innerHTML = '❌ Please enter a postcode';
                return;
            }
            
            resultsDiv.innerHTML = `🔄 Fetching data for ${newPostcode}...`;
            
            try {
                // Get location data for the new postcode
                const locationData = await fetchLocationData(newPostcode);
                
                if (locationData) {
                    // Update global variables
                    currentPostcode = newPostcode;
                    currentCoordinates = {
                        lat: locationData.latitude,
                        lon: locationData.longitude
                    };
                    
                    // Update the property address in the UI
                    updatePropertyAddress(newPostcode, locationData);
                    
                    // Refresh all property data with new location
                    await loadPropertyInsights();
                    await loadPropertyMarketData();
                    
                    // Show property-specific data for the new postcode
                    await showPropertyDataForPostcode(newPostcode);
                    
                    resultsDiv.innerHTML = `
                        <div style="color: #22c55e; margin-bottom: 8px;">✅ Location updated successfully!</div>
                        <div><strong>New Location:</strong> ${locationData.region}, ${locationData.admin_district}</div>
                        <div><strong>Coordinates:</strong> ${locationData.latitude.toFixed(4)}, ${locationData.longitude.toFixed(4)}</div>
                        <div><strong>Country:</strong> ${locationData.country}</div>
                    `;
                    
                    // Add notification
                    addNotification('Location updated', `Property location changed to ${newPostcode}`);
                    
                } else {
                    resultsDiv.innerHTML = `❌ Postcode "${newPostcode}" not found. Please check and try again.`;
                }
                
            } catch (error) {
                resultsDiv.innerHTML = `❌ Error: ${error.message}`;
            }
        }
        
        function updatePropertyAddress(postcode, locationData) {
            // Update the property address in the dashboard
            const addressElements = document.querySelectorAll('[data-property-address]');
            addressElements.forEach(el => {
                el.textContent = `45 Oak Avenue, ${postcode}`;
            });
            
            // Update the page title if it exists
            const pageTitle = document.querySelector('.page-title');
            if (pageTitle && pageTitle.textContent.includes('Oak Avenue')) {
                pageTitle.textContent = `45 Oak Avenue, ${postcode}`;
            }
        }
        
        // Show property-specific data for any postcode
        async function showPropertyDataForPostcode(postcode) {
            const propertyDataContent = document.getElementById('propertyDataContent');
            const postcodePropertyData = document.getElementById('postcodePropertyData');
            
            if (!propertyDataContent || !postcodePropertyData) return;
            
            // Update the title
            const titleElement = postcodePropertyData.querySelector('div');
            titleElement.textContent = `🏠 Property Data for ${postcode}`;
            
            // Show loading state
            propertyDataContent.innerHTML = 'Loading property data...';
            
            try {
                // Check if we have specific data for this postcode
                const propertyData = propertyDataByPostcode[postcode];
                
                if (propertyData) {
                    // Show detailed property data
                    propertyDataContent.innerHTML = `
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                            <div><strong>Area:</strong> ${propertyData.area}</div>
                            <div><strong>Property Type:</strong> ${propertyData.propertyType}</div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                            <div><strong>Average Price:</strong> £${propertyData.averagePrice.toLocaleString()}</div>
                            <div><strong>Recent Sales:</strong> ${propertyData.recentSales} in last 6 months</div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                            <div><strong>Council Tax:</strong> ${propertyData.councilTax}</div>
                            <div><strong>Schools:</strong> ${propertyData.schools}</div>
                        </div>
                        <div style="margin-bottom: 8px;">
                            <strong>Transport:</strong> ${propertyData.transport}
                        </div>
                        <div>
                            <strong>Amenities:</strong> ${propertyData.amenities}
                        </div>
                    `;
                } else {
                    // For unknown postcodes, show generic data
                    propertyDataContent.innerHTML = `
                        <div style="color: #f59e0b; margin-bottom: 8px;">⚠️ Limited data available for ${postcode}</div>
                        <div style="margin-bottom: 4px;"><strong>Postcode:</strong> ${postcode}</div>
                        <div style="margin-bottom: 4px;"><strong>Status:</strong> Valid UK postcode</div>
                        <div style="margin-bottom: 4px;"><strong>Data Source:</strong> Postcodes.io API</div>
                        <div style="font-size: 11px; color: #999; margin-top: 8px;">
                            For detailed property data, try: M1 2AB, SW1A 1AA, B1 1AA, L1 8JQ, EH1 1AA
                        </div>
                    `;
                }
                
            } catch (error) {
                propertyDataContent.innerHTML = `
                    <div style="color: #dc2626;">❌ Error loading property data: ${error.message}</div>
                `;
            }
        }
        
        // ENHANCEMENT: Interactive API testing functions
        
        async function refreshPropertyData() {
            const resultsDiv = document.getElementById('apiResults');
            resultsDiv.innerHTML = '🔄 Refreshing all property data...';
            
            try {
                await loadPropertyInsights();
                resultsDiv.innerHTML = '✅ Property data refreshed successfully!';
            } catch (error) {
                resultsDiv.innerHTML = '❌ Error refreshing data: ' + error.message;
            }
        }
        
        async function getLocationInfo() {
            const resultsDiv = document.getElementById('apiResults');
            resultsDiv.innerHTML = '📍 Fetching location data from Postcodes.io...';
            
            try {
                const data = await fetchLocationData(currentPostcode);
                if (data) {
                    resultsDiv.innerHTML = `
                        <div style="color: #22c55e; margin-bottom: 8px;">✅ Location data received:</div>
                        <div><strong>Postcode:</strong> ${currentPostcode}</div>
                        <div><strong>Region:</strong> ${data.region}</div>
                        <div><strong>District:</strong> ${data.admin_district}</div>
                        <div><strong>Coordinates:</strong> ${data.latitude}, ${data.longitude}</div>
                        <div><strong>Country:</strong> ${data.country}</div>
                    `;
                } else {
                    resultsDiv.innerHTML = '❌ No location data received';
                }
            } catch (error) {
                resultsDiv.innerHTML = '❌ Error: ' + error.message;
            }
        }
        
        async function getWeatherInfo() {
            const resultsDiv = document.getElementById('apiResults');
            resultsDiv.innerHTML = '🌤️ Fetching weather data...';
            
            try {
                const data = await fetchWeatherData(currentCoordinates.lat, currentCoordinates.lon);
                if (data && data.current_weather) {
                    const weather = data.current_weather;
                    resultsDiv.innerHTML = `
                        <div style="color: #22c55e; margin-bottom: 8px;">✅ Weather data received:</div>
                        <div><strong>Location:</strong> ${currentPostcode}</div>
                        <div><strong>Temperature:</strong> ${weather.temperature}°C</div>
                        <div><strong>Weather Code:</strong> ${weather.weathercode}</div>
                        <div><strong>Wind Speed:</strong> ${weather.windspeed} km/h</div>
                        <div><strong>Wind Direction:</strong> ${weather.winddirection}°</div>
                    `;
                } else {
                    resultsDiv.innerHTML = '❌ No weather data received';
                }
            } catch (error) {
                resultsDiv.innerHTML = '❌ Error: ' + error.message;
            }
        }
        
        // API Testing Functions
        
        async function testPostcodesAPI() {
            const resultsDiv = document.getElementById('apiTestResults');
            resultsDiv.innerHTML = '📍 Testing Postcodes.io API...';
            
            try {
                const data = await fetchLocationData(currentPostcode);
                if (data) {
                    resultsDiv.innerHTML = `
                        <div style="color: #22c55e; margin-bottom: 8px;">✅ Postcodes.io API Working!</div>
                        <div><strong>API:</strong> https://api.postcodes.io/postcodes/${currentPostcode}</div>
                        <div><strong>Postcode:</strong> ${currentPostcode}</div>
                        <div><strong>Region:</strong> ${data.region}</div>
                        <div><strong>District:</strong> ${data.admin_district}</div>
                        <div><strong>Coordinates:</strong> ${data.latitude}, ${data.longitude}</div>
                    `;
                } else {
                    resultsDiv.innerHTML = '❌ Postcodes.io API failed';
                }
            } catch (error) {
                resultsDiv.innerHTML = '❌ Error: ' + error.message;
            }
        }
        
        async function testWeatherAPI() {
            const resultsDiv = document.getElementById('apiTestResults');
            resultsDiv.innerHTML = '🌤️ Testing Weather API...';
            
            try {
                const data = await fetchWeatherData(currentCoordinates.lat, currentCoordinates.lon);
                if (data && data.current_weather) {
                    resultsDiv.innerHTML = `
                        <div style="color: #22c55e; margin-bottom: 8px;">✅ Weather API Working!</div>
                        <div><strong>API:</strong> https://api.open-meteo.com/v1/forecast</div>
                        <div><strong>Location:</strong> ${currentPostcode}</div>
                        <div><strong>Temperature:</strong> ${data.current_weather.temperature}°C</div>
                        <div><strong>Weather Code:</strong> ${data.current_weather.weathercode}</div>
                        <div><strong>Wind Speed:</strong> ${data.current_weather.windspeed} km/h</div>
                    `;
                } else {
                    resultsDiv.innerHTML = '❌ Weather API failed';
                }
            } catch (error) {
                resultsDiv.innerHTML = '❌ Error: ' + error.message;
            }
        }
        
        async function testPropertyAPI() {
            const resultsDiv = document.getElementById('apiTestResults');
            resultsDiv.innerHTML = '🏠 Testing Property API...';
            
            try {
                const data = await fetchPropertyDetails(`45 Oak Avenue, Manchester ${currentPostcode}`);
                if (data) {
                    resultsDiv.innerHTML = `
                        <div style="color: #22c55e; margin-bottom: 8px;">✅ Property API Working!</div>
                        <div><strong>API:</strong> https://nominatim.openstreetmap.org/search</div>
                        <div><strong>Address:</strong> 45 Oak Avenue, Manchester ${currentPostcode}</div>
                        <div><strong>Property Type:</strong> ${data.type || 'Residential'}</div>
                        <div><strong>OSM ID:</strong> ${data.osm_id || 'N/A'}</div>
                        <div><strong>Display Name:</strong> ${data.display_name}</div>
                    `;
                } else {
                    resultsDiv.innerHTML = '❌ Property API failed';
                }
            } catch (error) {
                resultsDiv.innerHTML = '❌ Error: ' + error.message;
            }
        }
        
        async function testAllAPIs() {
            const resultsDiv = document.getElementById('apiTestResults');
            resultsDiv.innerHTML = '🚀 Testing all APIs...';
            
            try {
                const [locationData, weatherData, propertyData] = await Promise.all([
                    fetchLocationData(currentPostcode),
                    fetchWeatherData(currentCoordinates.lat, currentCoordinates.lon),
                    fetchPropertyDetails(`45 Oak Avenue, Manchester ${currentPostcode}`)
                ]);
                
                let results = `<div style="color: #22c55e; margin-bottom: 8px;">✅ All APIs Working for ${currentPostcode}!</div>`;
                
                if (locationData) {
                    results += `<div><strong>📍 Location:</strong> ${locationData.region}, ${locationData.admin_district}</div>`;
                }
                
                if (weatherData && weatherData.current_weather) {
                    results += `<div><strong>🌤️ Weather:</strong> ${weatherData.current_weather.temperature}°C</div>`;
                }
                
                if (propertyData) {
                    results += `<div><strong>🏠 Property:</strong> ${propertyData.type || 'Residential'}</div>`;
                }
                
                resultsDiv.innerHTML = results;
                
            } catch (error) {
                resultsDiv.innerHTML = '❌ Error testing APIs: ' + error.message;
            }
        }
        
        // ENHANCEMENT: Property search and valuation functionality
        
        // Mock property data for different postcodes
        const propertySearchData = {
            'M1 2AB': [
                {
                    id: 1,
                    address: '45 Oak Avenue, Manchester M1 2AB',
                    price: 285000,
                    bedrooms: 3,
                    bathrooms: 2,
                    type: 'Terraced house',
                    description: 'Victorian terraced house in city centre',
                    features: ['Garden', 'Parking', 'Period features'],
                    marketValue: 275000,
                    isGoodDeal: true,
                    dealScore: 85
                },
                {
                    id: 2,
                    address: '23 Elm Street, Manchester M1 2AB',
                    price: 320000,
                    bedrooms: 4,
                    bathrooms: 3,
                    type: 'Semi-detached',
                    description: 'Modern semi-detached with garden',
                    features: ['Garden', 'Garage', 'Modern kitchen'],
                    marketValue: 310000,
                    isGoodDeal: false,
                    dealScore: 45
                }
            ],
            'SW1A 1AA': [
                {
                    id: 3,
                    address: '12 Buckingham Palace Road, London SW1A 1AA',
                    price: 2500000,
                    bedrooms: 2,
                    bathrooms: 2,
                    type: 'Historic apartment',
                    description: 'Luxury apartment near Buckingham Palace',
                    features: ['Concierge', 'Parking', 'Historic building'],
                    marketValue: 2400000,
                    isGoodDeal: true,
                    dealScore: 78
                }
            ],
            'B1 1AA': [
                {
                    id: 4,
                    address: '78 New Street, Birmingham B1 1AA',
                    price: 180000,
                    bedrooms: 2,
                    bathrooms: 1,
                    type: 'Modern apartment',
                    description: 'City centre apartment with views',
                    features: ['Balcony', 'Gym', 'Concierge'],
                    marketValue: 175000,
                    isGoodDeal: true,
                    dealScore: 82
                }
            ]
        };
        
        async function searchProperties() {
            const searchInput = document.getElementById('propertySearchInput');
            const searchResults = document.getElementById('searchResults');
            const valuationResults = document.getElementById('valuationResults');
            const marketAnalysis = document.getElementById('marketAnalysis');
            
            const searchTerm = searchInput.value.trim();
            if (!searchTerm) {
                searchResults.innerHTML = '<div style="color: #dc2626;">Please enter a postcode or address</div>';
                return;
            }
            
            searchResults.innerHTML = '🔍 Searching for properties...';
            
            try {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Extract postcode from search term
                const postcodeMatch = searchTerm.match(/[A-Z]{1,2}[0-9]{1,2}[A-Z]? [0-9][A-Z]{2}/i);
                const postcode = postcodeMatch ? postcodeMatch[0].toUpperCase() : searchTerm.toUpperCase();
                
                const properties = propertySearchData[postcode] || [];
                
                if (properties.length === 0) {
                    searchResults.innerHTML = `
                        <div style="color: #f59e0b; margin-bottom: 8px;">⚠️ No properties found for "${searchTerm}"</div>
                        <div style="font-size: 12px; color: #666;">
                            Try these postcodes: M1 2AB, SW1A 1AA, B1 1AA
                        </div>
                    `;
                    return;
                }
                
                // Display search results
                searchResults.innerHTML = `
                    <div style="color: #22c55e; margin-bottom: 12px;">✅ Found ${properties.length} properties</div>
                    <div style="display: grid; gap: 12px;">
                        ${properties.map(property => `
                            <div style="border: 1px solid #e5e5e5; border-radius: 8px; padding: 16px; background: white; cursor: pointer;" 
                                 onclick="selectProperty(${property.id}, '${postcode}')">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                                    <div>
                                        <div style="font-weight: 600; margin-bottom: 4px;">${property.address}</div>
                                        <div style="font-size: 12px; color: #666;">${property.type} • ${property.bedrooms} bed • ${property.bathrooms} bath</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-weight: 600; color: #8b5cf6;">£${property.price.toLocaleString()}</div>
                                        <div style="font-size: 12px; color: ${property.isGoodDeal ? '#22c55e' : '#dc2626'};">
                                            ${property.isGoodDeal ? 'Good Deal' : 'Overpriced'}
                                        </div>
                                    </div>
                                </div>
                                <div style="font-size: 12px; color: #666; margin-bottom: 8px;">${property.description}</div>
                                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                    ${property.features.map(feature => `
                                        <span style="background: #f0f0f0; padding: 2px 8px; border-radius: 4px; font-size: 11px;">${feature}</span>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
            } catch (error) {
                searchResults.innerHTML = `<div style="color: #dc2626;">❌ Error searching properties: ${error.message}</div>`;
            }
        }
        
        function selectProperty(propertyId, postcode) {
            const properties = propertySearchData[postcode] || [];
            const property = properties.find(p => p.id === propertyId);
            
            if (!property) return;
            
            // Show valuation results
            const valuationResults = document.getElementById('valuationResults');
            const marketAnalysis = document.getElementById('marketAnalysis');
            
            const priceDiff = property.price - property.marketValue;
            const priceDiffPercent = ((priceDiff / property.marketValue) * 100).toFixed(1);
            const isGoodDeal = property.isGoodDeal;
            
            valuationResults.innerHTML = `
                <div style="margin-bottom: 16px;">
                    <div style="font-weight: 600; font-size: 16px; margin-bottom: 8px;">${property.address}</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div>
                            <div style="font-size: 12px; color: #666; margin-bottom: 4px;">Asking Price</div>
                            <div style="font-size: 20px; font-weight: 600; color: #8b5cf6;">£${property.price.toLocaleString()}</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #666; margin-bottom: 4px;">Market Value</div>
                            <div style="font-size: 20px; font-weight: 600; color: #666;">£${property.marketValue.toLocaleString()}</div>
                        </div>
                    </div>
                </div>
                
                <div style="background: ${isGoodDeal ? '#f0fdf4' : '#fef2f2'}; border: 1px solid ${isGoodDeal ? '#22c55e' : '#dc2626'}; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <span style="font-size: 24px; margin-right: 8px;">${isGoodDeal ? '✅' : '❌'}</span>
                        <div>
                            <div style="font-weight: 600; color: ${isGoodDeal ? '#22c55e' : '#dc2626'};">
                                ${isGoodDeal ? 'Good Deal!' : 'Overpriced'}
                            </div>
                            <div style="font-size: 12px; color: #666;">
                                ${priceDiff > 0 ? `£${priceDiff.toLocaleString()} above market` : `£${Math.abs(priceDiff).toLocaleString()} below market`}
                                (${priceDiffPercent}%)
                            </div>
                        </div>
                    </div>
                    <div style="font-size: 14px; color: #666;">
                        Deal Score: <strong>${property.dealScore}/100</strong>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; font-size: 12px;">
                    <div><strong>Property Type:</strong> ${property.type}</div>
                    <div><strong>Bedrooms:</strong> ${property.bedrooms}</div>
                    <div><strong>Bathrooms:</strong> ${property.bathrooms}</div>
                    <div><strong>Features:</strong> ${property.features.join(', ')}</div>
                </div>
            `;
            
            // Show market analysis
            marketAnalysis.innerHTML = `
                <div style="margin-bottom: 12px;">
                    <div style="font-weight: 600; margin-bottom: 8px;">Market Analysis for ${postcode}</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; font-size: 12px;">
                        <div><strong>Average Price:</strong> £${property.marketValue.toLocaleString()}</div>
                        <div><strong>Price Trend:</strong> ${isGoodDeal ? 'Rising' : 'Stable'}</div>
                        <div><strong>Demand:</strong> ${isGoodDeal ? 'High' : 'Medium'}</div>
                        <div><strong>Supply:</strong> Limited</div>
                    </div>
                </div>
                <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; font-size: 12px; color: #666;">
                    <strong>Recommendation:</strong> ${isGoodDeal ? 
                        'This property represents good value for money. Consider making an offer quickly as good deals don\'t last long.' :
                        'This property is priced above market value. Consider negotiating or looking for better value elsewhere.'
                    }
                </div>
            `;
        }
        
        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
        
        // Initialize data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateProgressBar();
            updateStuckItems();
            updateNextSteps();
            loadPropertyMarketData();
            loadPropertyInsights();
            showPropertyDataForPostcode(currentPostcode);
            
            // Set up form submissions
            document.getElementById('updateForm').addEventListener('submit', addTimelineUpdate);
            document.getElementById('addPersonForm').addEventListener('submit', addPerson);
            
            // Close data menu when clicking outside
            document.addEventListener('click', function(e) {
                const dataMenu = document.getElementById('dataMenu');
                const dataMenuButton = e.target.closest('[onclick="toggleDataMenu()"]');
                if (dataMenu && !dataMenu.contains(e.target) && !dataMenuButton) {
                    dataMenu.style.display = 'none';
                }
            });
            
            // Close modals when clicking outside
            document.getElementById('updateModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeUpdateModal();
                }
            });
            
            document.getElementById('addPersonModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAddPersonModal();
                }
            });
            
            // Close modals with ESC key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeUpdateModal();
                    closeAddPersonModal();
                }
            });
        });
    </script>
</body>
</html>

